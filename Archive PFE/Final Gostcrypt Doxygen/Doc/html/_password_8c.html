<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Gostcrypt: Common/Password.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Gostcrypt
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_4ab6b4cc6a7edbff49100e9123df213f.html">Common</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Password.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Manage the basic checks and actions on the password such as creating / modifying checking length and encoding.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;Gstdefs.h&quot;</code><br />
<code>#include &quot;Crypto.h&quot;</code><br />
<code>#include &quot;Volumes.h&quot;</code><br />
<code>#include &quot;Password.h&quot;</code><br />
<code>#include &quot;Dlgcode.h&quot;</code><br />
<code>#include &quot;Language.h&quot;</code><br />
<code>#include &quot;Pkcs5.h&quot;</code><br />
<code>#include &quot;Endian.h&quot;</code><br />
<code>#include &quot;Random.h&quot;</code><br />
<code>#include &lt;io.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for Password.c:</div>
<div class="dyncontent">
<div class="center"><img src="_password_8c__incl.png" border="0" usemap="#_common_2_password_8c" alt=""/></div>
<map name="_common_2_password_8c" id="_common_2_password_8c">
<area shape="rect" id="node2" href="_gstdefs_8h_source.html" title="Gstdefs.h" alt="" coords="297,453,376,480"/>
<area shape="rect" id="node5" href="_crypto_8h_source.html" title="Crypto.h" alt="" coords="644,304,715,331"/>
<area shape="rect" id="node12" href="_password_8h_source.html" title="Password.h" alt="" coords="1131,379,1222,405"/>
<area shape="rect" id="node13" href="_volumes_8h_source.html" title="Volumes.h" alt="" coords="827,229,911,256"/>
<area shape="rect" id="node14" href="_dlgcode_8h_source.html" title="Dlgcode.h" alt="" coords="521,80,601,107"/>
<area shape="rect" id="node20" href="_language_8h_source.html" title="Language.h" alt="" coords="987,80,1076,107"/>
<area shape="rect" id="node22" href="_pkcs5_8h_source.html" title="Pkcs5.h" alt="" coords="5,304,76,331"/>
<area shape="rect" id="node23" href="_endian_8h_source.html" title="Endian.h" alt="" coords="100,304,173,331"/>
<area shape="rect" id="node24" href="_random_8h_source.html" title="Random.h" alt="" coords="319,155,400,181"/>
<area shape="rect" id="node6" href="_gost_cipher_8h_source.html" title="GostCipher.h" alt="" coords="630,379,729,405"/>
<area shape="rect" id="node7" href="_grasshopper_cipher_8h_source.html" title="GrasshopperCipher.h" alt="" coords="753,379,897,405"/>
<area shape="rect" id="node8" href="_stribog_8h_source.html" title="Stribog.h" alt="" coords="921,379,995,405"/>
<area shape="rect" id="node9" href="_whirlpool_8h_source.html" title="Whirlpool.h" alt="" coords="1020,379,1107,405"/>
<area shape="rect" id="node10" href="_gost_hash_8h_source.html" title="GostHash.h" alt="" coords="515,379,606,405"/>
<area shape="rect" id="node11" href="_gf_mul_8h_source.html" title="GfMul.h" alt="" coords="425,379,491,405"/>
<area shape="rect" id="node15" href="_common_8h_source.html" title="Common.h" alt="" coords="717,229,802,256"/>
<area shape="rect" id="node16" href="_apidrvr_8h_source.html" title="Apidrvr.h" alt="" coords="525,155,597,181"/>
<area shape="rect" id="node18" href="_wipe_8h_source.html" title="Wipe.h" alt="" coords="328,229,391,256"/>
<area shape="rect" id="node19" href="_keyfiles_8h_source.html" title="Keyfiles.h" alt="" coords="712,155,791,181"/>
<area shape="rect" id="node17" href="_boot_defs_8h_source.html" title="Boot/Windows/BootDefs.h" alt="" coords="467,229,641,256"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a523488d13475ba45022f7fab8e01d047"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_password_8c.html#a523488d13475ba45022f7fab8e01d047">VerifyPasswordAndUpdate</a> (HWND hwndDlg, HWND hButton, HWND hPassword, HWND hVerify, unsigned char *szPassword, char *szVerify, BOOL keyFilesEnabled)</td></tr>
<tr class="memdesc:a523488d13475ba45022f7fab8e01d047"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verify the password value (minimum size and repeated is equal) when the user enter it for the first time to protect its folder.  <a href="#a523488d13475ba45022f7fab8e01d047">More...</a><br /></td></tr>
<tr class="separator:a523488d13475ba45022f7fab8e01d047"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a8e1c5a24ae447c7af45f2e53973655"><td class="memItemLeft" align="right" valign="top">BOOL&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_password_8c.html#a1a8e1c5a24ae447c7af45f2e53973655">CheckPasswordCharEncoding</a> (HWND hPassword, <a class="el" href="struct_password.html">Password</a> *ptrPw)</td></tr>
<tr class="memdesc:a1a8e1c5a24ae447c7af45f2e53973655"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if the password contains ASCII or printable character.  <a href="#a1a8e1c5a24ae447c7af45f2e53973655">More...</a><br /></td></tr>
<tr class="separator:a1a8e1c5a24ae447c7af45f2e53973655"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3aca9dd7f358bffa36046c1709212bea"><td class="memItemLeft" align="right" valign="top">BOOL&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_password_8c.html#a3aca9dd7f358bffa36046c1709212bea">CheckPasswordLength</a> (HWND hwndDlg, HWND hwndItem)</td></tr>
<tr class="memdesc:a3aca9dd7f358bffa36046c1709212bea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check the password length.  <a href="#a3aca9dd7f358bffa36046c1709212bea">More...</a><br /></td></tr>
<tr class="separator:a3aca9dd7f358bffa36046c1709212bea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a572e279b7fade7cdb66f93c09102bb99"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_password_8c.html#a572e279b7fade7cdb66f93c09102bb99">ChangePwd</a> (char *lpszVolume, <a class="el" href="struct_password.html">Password</a> *oldPassword, <a class="el" href="struct_password.html">Password</a> *newPassword, int pkcs5, HWND hwndDlg)</td></tr>
<tr class="memdesc:a572e279b7fade7cdb66f93c09102bb99"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check the old password. Check all the requirements if the new password fits the rules and the program doesn't have problem. make a copy of teh ciphered area, encrypt the old area with the new password and if the encryption is successful change the password otherwise cancel.  <a href="#a572e279b7fade7cdb66f93c09102bb99">More...</a><br /></td></tr>
<tr class="separator:a572e279b7fade7cdb66f93c09102bb99"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Manage the basic checks and actions on the password such as creating / modifying checking length and encoding. </p>
<dl class="section version"><dt>Version</dt><dd>1.3.1 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>20/01/2017 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a572e279b7fade7cdb66f93c09102bb99"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a572e279b7fade7cdb66f93c09102bb99">&#9670;&nbsp;</a></span>ChangePwd()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ChangePwd </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>lpszVolume</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_password.html">Password</a> *&#160;</td>
          <td class="paramname"><em>oldPassword</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_password.html">Password</a> *&#160;</td>
          <td class="paramname"><em>newPassword</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pkcs5</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">HWND&#160;</td>
          <td class="paramname"><em>hwndDlg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check the old password. Check all the requirements if the new password fits the rules and the program doesn't have problem. make a copy of teh ciphered area, encrypt the old area with the new password and if the encryption is successful change the password otherwise cancel. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">HWND</td><td>hwndDlg </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">int</td><td>pkcs5 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="struct_password.html">Password</a></td><td>* newPassword </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="struct_password.html">Password</a></td><td>* oldPassword </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">char</td><td>* lpszVolume </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int ERR_OS_ERROR if (nDosLinkCreated != 0) ERR_OS_ERROR if (dev == INVALID_HANDLE_VALUE) ERR_OS_ERROR if (bDevice &amp;&amp; (dev == INVALID_HANDLE_VALUE)) ERR_OS_ERROR if (bDevice &amp;&amp; !(dev == INVALID_HANDLE_VALUE) &amp;&amp; (!bResult)) ERR_VOL_SIZE_WRONG if (bDevice &amp;&amp; !(dev == INVALID_HANDLE_VALUE) &amp;&amp; (hostSize == 0)) ERR_OS_ERROR if (!bDevice &amp;&amp; (!GetFileSizeEx (dev, &amp;fileSize)))</dd></dl>
<p>ERR_OS_ERROR if (Randinit ()) ERR_OS_ERROR if (!SetFilePointerEx ((HANDLE) dev, headerOffset, NULL, FILE_BEGIN)) ERR_OS_ERROR if (!ReadEffectiveVolumeHeader (bDevice, dev, buffer, &amp;bytesRead)) ERR_SYS_HIDVOL_HEAD_REENC_MODE_WRONG if (cryptoInfo-&gt;HeaderFlags &amp; GST_HEADER_FLAG_ENCRYPTED_SYSTEM) ERR_OS_ERROR if (!SetFilePointerEx ((HANDLE) dev, headerOffset, NULL, FILE_BEGIN)) ERR_OS_ERROR if (!WriteEffectiveVolumeHeader (bDevice, dev, buffer)) WriteRandomDataToReservedHeaderAreas (dev, cryptoInfo, cryptoInfo-&gt;VolumeSize.Value, !backupHeader, backupHeader) if (nStatus != ERR_SUCCESS) 0 else </p>
<p>The header will be re-encrypted PRAND_DISK_WIPE_PASSES times to prevent adversaries from using techniques such as magnetic force microscopy or magnetic force scanning tunnelling microscopy to recover the overwritten header. According to Peter Gutmann, data should be overwritten 22 times (ideally, 35 times) using non-random patterns and pseudorandom data. However, as users might impatiently interupt the process (etc.) we will not use the Gutmann's patterns but will write the valid re-encrypted header, i.e. pseudorandom data, and there will be many more passes than Guttman recommends. During each pass we will write a valid working header. Each pass will use the same master key, and also the same header key, secondary key (XTS), etc., derived from the new password. The only item that will be different for each pass will be the salt. This is sufficient to cause each "version" of the header to differ substantially and in a random manner from the versions written during the other passes.</p>

</div>
</div>
<a id="a1a8e1c5a24ae447c7af45f2e53973655"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a8e1c5a24ae447c7af45f2e53973655">&#9670;&nbsp;</a></span>CheckPasswordCharEncoding()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOL CheckPasswordCharEncoding </td>
          <td>(</td>
          <td class="paramtype">HWND&#160;</td>
          <td class="paramname"><em>hPassword</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_password.html">Password</a> *&#160;</td>
          <td class="paramname"><em>ptrPw</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if the password contains ASCII or printable character. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="struct_password.html">Password</a></td><td>* ptrPw </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">HWND</td><td>hPassword </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOL FALSE if (i &lt; len) FALSE if (len &gt; MAX_PASSWORD) FALSE if (pw[i] &gt;= 0x7f || pw[i] &lt; 0x20) TRUE else </dd></dl>

</div>
</div>
<a id="a3aca9dd7f358bffa36046c1709212bea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3aca9dd7f358bffa36046c1709212bea">&#9670;&nbsp;</a></span>CheckPasswordLength()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOL CheckPasswordLength </td>
          <td>(</td>
          <td class="paramtype">HWND&#160;</td>
          <td class="paramname"><em>hwndDlg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">HWND&#160;</td>
          <td class="paramname"><em>hwndItem</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check the password length. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">HWND</td><td>hwndItem </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">HWND</td><td>hwndDlg </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOL FALSE if (MessageBoxW (hwndDlg, GetString ("PASSWORD_LENGTH_WARNING"), lpszTitle, MB_YESNO|MB_ICONWARNING|MB_DEFBUTTON2) != IDYES) TRUE else </dd></dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="_password_8c_a3aca9dd7f358bffa36046c1709212bea_cgraph.png" border="0" usemap="#_password_8c_a3aca9dd7f358bffa36046c1709212bea_cgraph" alt=""/></div>
<map name="_password_8c_a3aca9dd7f358bffa36046c1709212bea_cgraph" id="_password_8c_a3aca9dd7f358bffa36046c1709212bea_cgraph">
<area shape="rect" id="node2" href="_boot_console_io_8cpp.html#a33007bfd2971c5edeb62670ed938205f" title="Print the string buffer and return the position when escape key is pressed or at the end of the buffe..." alt="" coords="208,5,285,32"/>
</map>
</div>

</div>
</div>
<a id="a523488d13475ba45022f7fab8e01d047"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a523488d13475ba45022f7fab8e01d047">&#9670;&nbsp;</a></span>VerifyPasswordAndUpdate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void VerifyPasswordAndUpdate </td>
          <td>(</td>
          <td class="paramtype">HWND&#160;</td>
          <td class="paramname"><em>hwndDlg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">HWND&#160;</td>
          <td class="paramname"><em>hButton</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">HWND&#160;</td>
          <td class="paramname"><em>hPassword</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">HWND&#160;</td>
          <td class="paramname"><em>hVerify</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>szPassword</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>szVerify</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BOOL&#160;</td>
          <td class="paramname"><em>keyFilesEnabled</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Verify the password value (minimum size and repeated is equal) when the user enter it for the first time to protect its folder. </p>
<p>Legal Notice: Some portions of the source code contained in this file were derived from the source code of Encryption for the Masses 2.02a, which is Copyright (c) 1998-2000 Paul Le Roux and which is governed by the 'License Agreement for Encryption for the Masses'. Modifications and additions to the original source code (contained in this file) and all other portions of this file are Copyright (c) 2003-2010 TrueCrypt Developers Association and are governed by the TrueCrypt License 3.0 the full text of which is contained in the file License.txt included in TrueCrypt binary and source code distribution packages.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">HWND</td><td>hwndDlg </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">HWND</td><td>hButton </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">HWND</td><td>hPassword </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">HWND</td><td>hVerify </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">unsigned</td><td>char * szPassword </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">char</td><td>* szVerify </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">BOOL</td><td>keyFilesEnabled </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
