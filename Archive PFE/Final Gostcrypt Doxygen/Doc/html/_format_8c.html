<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Gostcrypt: Common/Format.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Gostcrypt
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_4ab6b4cc6a7edbff49100e9123df213f.html">Common</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">Format.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Manage formatting functions (formatting threads)  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &quot;Gstdefs.h&quot;</code><br />
<code>#include &quot;Common.h&quot;</code><br />
<code>#include &quot;Crypto.h&quot;</code><br />
<code>#include &quot;Fat.h&quot;</code><br />
<code>#include &quot;Format.h&quot;</code><br />
<code>#include &quot;Random.h&quot;</code><br />
<code>#include &quot;Volumes.h&quot;</code><br />
<code>#include &quot;Apidrvr.h&quot;</code><br />
<code>#include &quot;Dlgcode.h&quot;</code><br />
<code>#include &quot;Language.h&quot;</code><br />
<code>#include &quot;Progress.h&quot;</code><br />
<code>#include &quot;Resource.h&quot;</code><br />
<code>#include &quot;Format/FormatCom.h&quot;</code><br />
<code>#include &quot;Format/Gstformat.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for Format.c:</div>
<div class="dyncontent">
<div class="center"><img src="_format_8c__incl.png" border="0" usemap="#_common_2_format_8c" alt=""/></div>
<map name="_common_2_format_8c" id="_common_2_format_8c">
<area shape="rect" id="node4" href="_gstdefs_8h_source.html" title="Gstdefs.h" alt="" coords="375,453,453,480"/>
<area shape="rect" id="node7" href="_common_8h_source.html" title="Common.h" alt="" coords="314,229,399,256"/>
<area shape="rect" id="node8" href="_crypto_8h_source.html" title="Crypto.h" alt="" coords="349,304,420,331"/>
<area shape="rect" id="node16" href="_fat_8h_source.html" title="Fat.h" alt="" coords="1016,80,1068,107"/>
<area shape="rect" id="node17" href="_format_8h_source.html" title="Format.h" alt="" coords="998,304,1073,331"/>
<area shape="rect" id="node18" href="_random_8h_source.html" title="Random.h" alt="" coords="560,155,641,181"/>
<area shape="rect" id="node19" href="_volumes_8h_source.html" title="Volumes.h" alt="" coords="915,229,999,256"/>
<area shape="rect" id="node20" href="_apidrvr_8h_source.html" title="Apidrvr.h" alt="" coords="767,155,839,181"/>
<area shape="rect" id="node23" href="_dlgcode_8h_source.html" title="Dlgcode.h" alt="" coords="690,80,770,107"/>
<area shape="rect" id="node25" href="_language_8h_source.html" title="Language.h" alt="" coords="1092,80,1181,107"/>
<area shape="rect" id="node27" href="_progress_8h_source.html" title="Progress.h" alt="" coords="1377,80,1462,107"/>
<area shape="rect" id="node28" href="_common_2_resource_8h_source.html" title="Resource.h" alt="" coords="1486,80,1574,107"/>
<area shape="rect" id="node29" href="_format_com_8h_source.html" title="Format/FormatCom.h" alt="" coords="1206,80,1353,107"/>
<area shape="rect" id="node30" href="_gstformat_8h_source.html" title="Format/Gstformat.h" alt="" coords="247,155,381,181"/>
<area shape="rect" id="node9" href="_gost_cipher_8h_source.html" title="GostCipher.h" alt="" coords="471,379,570,405"/>
<area shape="rect" id="node10" href="_grasshopper_cipher_8h_source.html" title="GrasshopperCipher.h" alt="" coords="594,379,738,405"/>
<area shape="rect" id="node11" href="_stribog_8h_source.html" title="Stribog.h" alt="" coords="117,379,191,405"/>
<area shape="rect" id="node12" href="_whirlpool_8h_source.html" title="Whirlpool.h" alt="" coords="5,379,92,405"/>
<area shape="rect" id="node13" href="_gost_hash_8h_source.html" title="GostHash.h" alt="" coords="215,379,306,405"/>
<area shape="rect" id="node14" href="_gf_mul_8h_source.html" title="GfMul.h" alt="" coords="381,379,447,405"/>
<area shape="rect" id="node15" href="_password_8h_source.html" title="Password.h" alt="" coords="914,379,1005,405"/>
<area shape="rect" id="node21" href="_boot_defs_8h_source.html" title="Boot/Windows/BootDefs.h" alt="" coords="613,229,788,256"/>
<area shape="rect" id="node22" href="_wipe_8h_source.html" title="Wipe.h" alt="" coords="475,229,537,256"/>
<area shape="rect" id="node24" href="_keyfiles_8h_source.html" title="Keyfiles.h" alt="" coords="457,155,536,181"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:af5bb47d2c6d316ca8e20ae952fc80fc1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="union_u_i_n_t64___s_t_r_u_c_t.html">uint64</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_format_8c.html#af5bb47d2c6d316ca8e20ae952fc80fc1">GetVolumeDataAreaSize</a> (BOOL hiddenVolume, <a class="el" href="union_u_i_n_t64___s_t_r_u_c_t.html">uint64</a> volumeSize)</td></tr>
<tr class="memdesc:af5bb47d2c6d316ca8e20ae952fc80fc1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the size of volume data area.  <a href="#af5bb47d2c6d316ca8e20ae952fc80fc1">More...</a><br /></td></tr>
<tr class="separator:af5bb47d2c6d316ca8e20ae952fc80fc1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c74d8614118b183c81ef435f27085db"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_format_8c.html#a7c74d8614118b183c81ef435f27085db">GSTFormatVolume</a> (volatile <a class="el" href="struct_f_o_r_m_a_t___v_o_l___p_a_r_a_m_e_t_e_r_s.html">FORMAT_VOL_PARAMETERS</a> *volParams)</td></tr>
<tr class="memdesc:a7c74d8614118b183c81ef435f27085db"><td class="mdescLeft">&#160;</td><td class="mdescRight">Format a volume as GST WARNING: Note that if Windows fails to format the volume as NTFS and the volume size is less than the maximum FAT size, the user is asked within this function whether he wants to instantly retry FAT format instead (to avoid having to re-create the whole container again). If the user answers yes, some of the input parameters are modified, the code below 'begin_format' is re-executed and some destructive operations that were performed during the first attempt must be (and are) skipped. Therefore, whenever adding or modifying any potentially destructive operations below 'begin_format', determine whether they (or their portions) need to be skipped during such a second attempt; if so, use the 'bInstantRetryOtherFilesys' flag to skip them.  <a href="#a7c74d8614118b183c81ef435f27085db">More...</a><br /></td></tr>
<tr class="separator:a7c74d8614118b183c81ef435f27085db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9bf3131bf7131ec27c58fe483c7aa7ce"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_format_8c.html#a9bf3131bf7131ec27c58fe483c7aa7ce">FormatNoFs</a> (unsigned __int64 startSector, __int64 num_sectors, void *dev, <a class="el" href="struct_c_r_y_p_t_o___i_n_f_o__t.html">PCRYPTO_INFO</a> cryptoInfo, BOOL quickFormat)</td></tr>
<tr class="memdesc:a9bf3131bf7131ec27c58fe483c7aa7ce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Seek to start sector Generate a random temporary key set to be used for "dummy" encryption that will fill the free disk space (data area) with random data. This is necessary for plausible deniability of hidden volumes. Restore the original secondary key (XTS mode) in case NTFS format fails and the user wants to try FAT immediately Reinitialize the encryption algorithm and mode in case NTFS format fails and the user wants to try FAT immediately.  <a href="#a9bf3131bf7131ec27c58fe483c7aa7ce">More...</a><br /></td></tr>
<tr class="separator:a9bf3131bf7131ec27c58fe483c7aa7ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82a19c75fb4818c875fcd6b877147850"><td class="memItemLeft" align="right" valign="top">BOOLEAN __stdcall&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_format_8c.html#a82a19c75fb4818c875fcd6b877147850">FormatExCallback</a> (int command, DWORD subCommand, PVOID parameter)</td></tr>
<tr class="memdesc:a82a19c75fb4818c875fcd6b877147850"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check FormatExResult global variable state.  <a href="#a82a19c75fb4818c875fcd6b877147850">More...</a><br /></td></tr>
<tr class="separator:a82a19c75fb4818c875fcd6b877147850"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96dcf751b1190c28e170c94ceca39849"><td class="memItemLeft" align="right" valign="top">BOOL&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_format_8c.html#a96dcf751b1190c28e170c94ceca39849">FormatNtfs</a> (int driveNo, int clusterSize)</td></tr>
<tr class="memdesc:a96dcf751b1190c28e170c94ceca39849"><td class="mdescLeft">&#160;</td><td class="mdescRight">Format to NTFS.  <a href="#a96dcf751b1190c28e170c94ceca39849">More...</a><br /></td></tr>
<tr class="separator:a96dcf751b1190c28e170c94ceca39849"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1abf5938ba2d0320ed6f80f2f14b6113"><td class="memItemLeft" align="right" valign="top">BOOL&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_format_8c.html#a1abf5938ba2d0320ed6f80f2f14b6113">WriteSector</a> (void *dev, char *sector, char *write_buf, int *write_buf_cnt, __int64 *nSecNo, <a class="el" href="struct_c_r_y_p_t_o___i_n_f_o__t.html">PCRYPTO_INFO</a> cryptoInfo)</td></tr>
<tr class="memdesc:a1abf5938ba2d0320ed6f80f2f14b6113"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write sector.  <a href="#a1abf5938ba2d0320ed6f80f2f14b6113">More...</a><br /></td></tr>
<tr class="separator:a1abf5938ba2d0320ed6f80f2f14b6113"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a07c269ac259805710977c69978f9c7c3"><td class="memItemLeft" align="right" valign="top">BOOL&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_format_8c.html#a07c269ac259805710977c69978f9c7c3">FlushFormatWriteBuffer</a> (void *dev, char *write_buf, int *write_buf_cnt, __int64 *nSecNo, <a class="el" href="struct_c_r_y_p_t_o___i_n_f_o__t.html">PCRYPTO_INFO</a> cryptoInfo)</td></tr>
<tr class="memdesc:a07c269ac259805710977c69978f9c7c3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flush the formatting write buffer.  <a href="#a07c269ac259805710977c69978f9c7c3">More...</a><br /></td></tr>
<tr class="separator:a07c269ac259805710977c69978f9c7c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:aaed35e0fc11c8d447a5c52448b83d7b0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_format_8c.html#aaed35e0fc11c8d447a5c52448b83d7b0">FormatWriteBufferSize</a> = 1024 * 1024</td></tr>
<tr class="separator:aaed35e0fc11c8d447a5c52448b83d7b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abfc4f025187ba09e1eabd57ab41de74b"><td class="memItemLeft" align="right" valign="top"><a id="abfc4f025187ba09e1eabd57ab41de74b"></a>
volatile BOOLEAN&#160;</td><td class="memItemRight" valign="bottom"><b>FormatExResult</b></td></tr>
<tr class="separator:abfc4f025187ba09e1eabd57ab41de74b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Manage formatting functions (formatting threads) </p>
<dl class="section version"><dt>Version</dt><dd>1.3.1 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>23/01/2017 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a07c269ac259805710977c69978f9c7c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a07c269ac259805710977c69978f9c7c3">&#9670;&nbsp;</a></span>FlushFormatWriteBuffer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOL FlushFormatWriteBuffer </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>write_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>write_buf_cnt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__int64 *&#160;</td>
          <td class="paramname"><em>nSecNo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_c_r_y_p_t_o___i_n_f_o__t.html">PCRYPTO_INFO</a>&#160;</td>
          <td class="paramname"><em>cryptoInfo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Flush the formatting write buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">PCRYPTO_INFO</td><td>cryptoInfo </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">__int64</td><td>* nSecNo </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">int</td><td>* write_buf_cnt </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">char</td><td>* write_buf </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">void</td><td>* dev </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOL TRUE if (*write_buf_cnt == 0) FALSE if (WriteThreadRunning &amp;&amp; (WaitForSingleObject (WriteBufferEmptyEvent, INFINITE) == WAIT_FAILED)) FALSE if (WriteThreadRunning &amp;&amp; (WriteRequestResult != ERROR_SUCCESS)) FALSE if (WriteThreadRunning &amp;&amp; (!SetEvent (WriteBufferFullEvent))) FALSE if (!WriteThreadRunning &amp;&amp; !WriteFile ((HANDLE) dev, write_buf, *write_buf_cnt, &amp;bytesWritten, NULL))) TRUE else </dd></dl>

</div>
</div>
<a id="a82a19c75fb4818c875fcd6b877147850"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82a19c75fb4818c875fcd6b877147850">&#9670;&nbsp;</a></span>FormatExCallback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOLEAN __stdcall FormatExCallback </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DWORD&#160;</td>
          <td class="paramname"><em>subCommand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID&#160;</td>
          <td class="paramname"><em>parameter</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check FormatExResult global variable state. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">PVOID</td><td>parameter </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">DWORD</td><td>subCommand </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">int</td><td>command </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN __stdcall TRUE </dd></dl>

</div>
</div>
<a id="a9bf3131bf7131ec27c58fe483c7aa7ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9bf3131bf7131ec27c58fe483c7aa7ce">&#9670;&nbsp;</a></span>FormatNoFs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int FormatNoFs </td>
          <td>(</td>
          <td class="paramtype">unsigned __int64&#160;</td>
          <td class="paramname"><em>startSector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__int64&#160;</td>
          <td class="paramname"><em>num_sectors</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_c_r_y_p_t_o___i_n_f_o__t.html">PCRYPTO_INFO</a>&#160;</td>
          <td class="paramname"><em>cryptoInfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BOOL&#160;</td>
          <td class="paramname"><em>quickFormat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Seek to start sector Generate a random temporary key set to be used for "dummy" encryption that will fill the free disk space (data area) with random data. This is necessary for plausible deniability of hidden volumes. Restore the original secondary key (XTS mode) in case NTFS format fails and the user wants to try FAT immediately Reinitialize the encryption algorithm and mode in case NTFS format fails and the user wants to try FAT immediately. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">BOOL</td><td>quickFormat </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">PCRYPTO_INFO</td><td>cryptoInfo </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">void</td><td>* dev </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">__int64</td><td>num_sectors </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">unsigned</td><td>__int64 startSector </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int ERR_OS_ERROR if (!SetFilePointerEx ((HANDLE) dev, startOffset, &amp;newOffset, FILE_BEGIN) || newOffset.QuadPart != startOffset.QuadPart) ERR_OUTOFMEMORY if (!write_buf) (retVal ? retVal : ERR_OS_ERROR) goto fail 0 else </dd></dl>

</div>
</div>
<a id="a96dcf751b1190c28e170c94ceca39849"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a96dcf751b1190c28e170c94ceca39849">&#9670;&nbsp;</a></span>FormatNtfs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOL FormatNtfs </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>driveNo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>clusterSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Format to NTFS. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">int</td><td>clusterSize </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">int</td><td>driveNo </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOL FALSE if (hModule == NULL) FALSE if (!(FormatEx = (PFORMATEX) GetProcAddress (GetModuleHandle ("fmifs.dll"), "FormatEx"))) FormatExResult else </dd></dl>

</div>
</div>
<a id="af5bb47d2c6d316ca8e20ae952fc80fc1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af5bb47d2c6d316ca8e20ae952fc80fc1">&#9670;&nbsp;</a></span>GetVolumeDataAreaSize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="union_u_i_n_t64___s_t_r_u_c_t.html">uint64</a> GetVolumeDataAreaSize </td>
          <td>(</td>
          <td class="paramtype">BOOL&#160;</td>
          <td class="paramname"><em>hiddenVolume</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="union_u_i_n_t64___s_t_r_u_c_t.html">uint64</a>&#160;</td>
          <td class="paramname"><em>volumeSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the size of volume data area. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">uint64</td><td>volumeSize </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">BOOL</td><td>hiddenVolume </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>uint64 0 if (volumeSize &lt; reservedSize) volumeSize - reservedSize else </dd></dl>

</div>
</div>
<a id="a7c74d8614118b183c81ef435f27085db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c74d8614118b183c81ef435f27085db">&#9670;&nbsp;</a></span>GSTFormatVolume()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GSTFormatVolume </td>
          <td>(</td>
          <td class="paramtype">volatile <a class="el" href="struct_f_o_r_m_a_t___v_o_l___p_a_r_a_m_e_t_e_r_s.html">FORMAT_VOL_PARAMETERS</a> *&#160;</td>
          <td class="paramname"><em>volParams</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Format a volume as GST WARNING: Note that if Windows fails to format the volume as NTFS and the volume size is less than the maximum FAT size, the user is asked within this function whether he wants to instantly retry FAT format instead (to avoid having to re-create the whole container again). If the user answers yes, some of the input parameters are modified, the code below 'begin_format' is re-executed and some destructive operations that were performed during the first attempt must be (and are) skipped. Therefore, whenever adding or modifying any potentially destructive operations below 'begin_format', determine whether they (or their portions) need to be skipped during such a second attempt; if so, use the 'bInstantRetryOtherFilesys' flag to skip them. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">volatile</td><td><a class="el" href="struct_f_o_r_m_a_t___v_o_l___p_a_r_a_m_e_t_e_r_s.html">FORMAT_VOL_PARAMETERS</a> * volParams </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int ERR_DONT_REPORT if (FormatSectorSize &lt; GST_MIN_VOLUME_SECTOR_SIZE || FormatSectorSize &gt; GST_MAX_VOLUME_SECTOR_SIZE || FormatSectorSize % ENCRYPTION_DATA_UNIT_SIZE != 0) ERR_VOL_SIZE_WRONG if (!volParams-&gt;hiddenVol &amp;&amp; (volParams-&gt;size &lt;= GST_TOTAL_VOLUME_HEADERS_SIZE)) nStatus if (nStatus != 0) ERR_OS_ERROR if (FakeDosNameForDevice (volParams-&gt;volumePath, dosDev, devName, FALSE) != 0) nStatus goto fv_end </dd></dl>

</div>
</div>
<a id="a1abf5938ba2d0320ed6f80f2f14b6113"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1abf5938ba2d0320ed6f80f2f14b6113">&#9670;&nbsp;</a></span>WriteSector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOL WriteSector </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>sector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>write_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>write_buf_cnt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__int64 *&#160;</td>
          <td class="paramname"><em>nSecNo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_c_r_y_p_t_o___i_n_f_o__t.html">PCRYPTO_INFO</a>&#160;</td>
          <td class="paramname"><em>cryptoInfo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write sector. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">PCRYPTO_INFO</td><td>cryptoInfo </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">__int64</td><td>* nSecNo </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">int</td><td>* write_buf_cnt </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">char</td><td>* write_buf </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">char</td><td>* sector </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">void</td><td>* dev </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOL FALSE if (*write_buf_cnt == FormatWriteBufferSize &amp;&amp; !FlushFormatWriteBuffer (dev, write_buf, write_buf_cnt, nSecNo, cryptoInfo)) FALSE if (GetTickCount () - updateTime &gt; 25 &amp;&amp; (UpdateProgressBar (*nSecNo * FormatSectorSize))) TRUE else </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="aaed35e0fc11c8d447a5c52448b83d7b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaed35e0fc11c8d447a5c52448b83d7b0">&#9670;&nbsp;</a></span>FormatWriteBufferSize</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int FormatWriteBufferSize = 1024 * 1024</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Legal Notice: Some portions of the source code contained in this file were derived from the source code of Encryption for the Masses 2.02a, which is Copyright (c) 1998-2000 Paul Le Roux and which is governed by the 'License Agreement for Encryption for the Masses'. Modifications and additions to the original source code (contained in this file) and all other portions of this file are Copyright (c) 2003-2010 TrueCrypt Developers Association and are governed by the TrueCrypt License 3.0 the full text of which is contained in the file License.txt included in TrueCrypt binary and source code distribution packages. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
