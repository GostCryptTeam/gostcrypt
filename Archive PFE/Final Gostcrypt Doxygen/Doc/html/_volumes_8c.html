<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Gostcrypt: Common/Volumes.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Gostcrypt
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_4ab6b4cc6a7edbff49100e9123df213f.html">Common</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">Volumes.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Manage the generation and use of header of volumes.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;Gstdefs.h&quot;</code><br />
<code>#include &lt;fcntl.h&gt;</code><br />
<code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &lt;time.h&gt;</code><br />
<code>#include &quot;EncryptionThreadPool.h&quot;</code><br />
<code>#include &lt;stddef.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;io.h&gt;</code><br />
<code>#include &quot;Random.h&quot;</code><br />
<code>#include &quot;Crc.h&quot;</code><br />
<code>#include &quot;Crypto.h&quot;</code><br />
<code>#include &quot;Endian.h&quot;</code><br />
<code>#include &quot;Volumes.h&quot;</code><br />
<code>#include &quot;Pkcs5.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for Volumes.c:</div>
<div class="dyncontent">
<div class="center"><img src="_volumes_8c__incl.png" border="0" usemap="#_common_2_volumes_8c" alt=""/></div>
<map name="_common_2_volumes_8c" id="_common_2_volumes_8c">
<area shape="rect" id="node2" href="_gstdefs_8h_source.html" title="Gstdefs.h" alt="" coords="160,304,238,331"/>
<area shape="rect" id="node8" href="_time_8h_source.html" title="time.h" alt="" coords="942,80,1000,107"/>
<area shape="rect" id="node17" href="_encryption_thread_pool_8h_source.html" title="EncryptionThreadPool.h" alt="" coords="398,80,558,107"/>
<area shape="rect" id="node18" href="_crypto_8h_source.html" title="Crypto.h" alt="" coords="452,155,522,181"/>
<area shape="rect" id="node29" href="_random_8h_source.html" title="Random.h" alt="" coords="582,80,664,107"/>
<area shape="rect" id="node30" href="_crc_8h_source.html" title="Crc.h" alt="" coords="800,155,854,181"/>
<area shape="rect" id="node31" href="_endian_8h_source.html" title="Endian.h" alt="" coords="878,155,952,181"/>
<area shape="rect" id="node32" href="_volumes_8h_source.html" title="Volumes.h" alt="" coords="692,155,776,181"/>
<area shape="rect" id="node33" href="_pkcs5_8h_source.html" title="Pkcs5.h" alt="" coords="1000,155,1070,181"/>
<area shape="rect" id="node9" href="_platform_base_8h_source.html" title="PlatformBase.h" alt="" coords="1246,155,1357,181"/>
<area shape="rect" id="node19" href="_gost_cipher_8h_source.html" title="GostCipher.h" alt="" coords="292,229,391,256"/>
<area shape="rect" id="node20" href="_grasshopper_cipher_8h_source.html" title="GrasshopperCipher.h" alt="" coords="415,229,559,256"/>
<area shape="rect" id="node21" href="_stribog_8h_source.html" title="Stribog.h" alt="" coords="583,229,658,256"/>
<area shape="rect" id="node22" href="_whirlpool_8h_source.html" title="Whirlpool.h" alt="" coords="40,229,126,256"/>
<area shape="rect" id="node23" href="_gost_hash_8h_source.html" title="GostHash.h" alt="" coords="682,229,772,256"/>
<area shape="rect" id="node24" href="_gf_mul_8h_source.html" title="GfMul.h" alt="" coords="202,229,268,256"/>
<area shape="rect" id="node25" href="_password_8h_source.html" title="Password.h" alt="" coords="796,229,887,256"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_key_derivation_work_item.html">KeyDerivationWorkItem</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a28fc4bf9ef4c56293aa4b387541cfe5e"><td class="memItemLeft" align="right" valign="top">uint16&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_volumes_8c.html#a28fc4bf9ef4c56293aa4b387541cfe5e">GetHeaderField16</a> (byte *header, int offset)</td></tr>
<tr class="memdesc:a28fc4bf9ef4c56293aa4b387541cfe5e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Getter for 16 bits value in a header, starting at the offset.  <a href="#a28fc4bf9ef4c56293aa4b387541cfe5e">More...</a><br /></td></tr>
<tr class="separator:a28fc4bf9ef4c56293aa4b387541cfe5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb33f14ce64d22f64717b2b2a92da656"><td class="memItemLeft" align="right" valign="top">uint32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_volumes_8c.html#aeb33f14ce64d22f64717b2b2a92da656">GetHeaderField32</a> (byte *header, int offset)</td></tr>
<tr class="memdesc:aeb33f14ce64d22f64717b2b2a92da656"><td class="mdescLeft">&#160;</td><td class="mdescRight">Getter for 32 bits value in a header, starting at the offset.  <a href="#aeb33f14ce64d22f64717b2b2a92da656">More...</a><br /></td></tr>
<tr class="separator:aeb33f14ce64d22f64717b2b2a92da656"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4f7e46232fce9725756858d64edbf1b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="union_u_i_n_t64___s_t_r_u_c_t.html">UINT64_STRUCT</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_volumes_8c.html#ab4f7e46232fce9725756858d64edbf1b">GetHeaderField64</a> (byte *header, int offset)</td></tr>
<tr class="memdesc:ab4f7e46232fce9725756858d64edbf1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Getter for 64 bits value in a header, starting at the offset.  <a href="#ab4f7e46232fce9725756858d64edbf1b">More...</a><br /></td></tr>
<tr class="separator:ab4f7e46232fce9725756858d64edbf1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa713bf1fa27171e0cc0aa16218fe10e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_volumes_8c.html#afa713bf1fa27171e0cc0aa16218fe10e">ReadVolumeHeader</a> (BOOL bBoot, char *encryptedHeader, <a class="el" href="struct_password.html">Password</a> *password, <a class="el" href="struct_c_r_y_p_t_o___i_n_f_o__t.html">PCRYPTO_INFO</a> *retInfo, <a class="el" href="struct_c_r_y_p_t_o___i_n_f_o__t.html">CRYPTO_INFO</a> *retHeaderCryptoInfo)</td></tr>
<tr class="memdesc:afa713bf1fa27171e0cc0aa16218fe10e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read the volume header using getter from 16 to 64 bits. It permits to load the volume with its parameters.  <a href="#afa713bf1fa27171e0cc0aa16218fe10e">More...</a><br /></td></tr>
<tr class="separator:afa713bf1fa27171e0cc0aa16218fe10e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25b0d6177527d33b06d34623e4f2800b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_volumes_8c.html#a25b0d6177527d33b06d34623e4f2800b">CreateVolumeHeaderInMemory</a> (BOOL bBoot, char *header, int ea, int mode, <a class="el" href="struct_password.html">Password</a> *password, int pkcs5_prf, char *masterKeydata, <a class="el" href="struct_c_r_y_p_t_o___i_n_f_o__t.html">PCRYPTO_INFO</a> *retInfo, unsigned __int64 volumeSize, unsigned __int64 hiddenVolumeSize, unsigned __int64 encryptedAreaStart, unsigned __int64 encryptedAreaLength, uint16 requiredProgramVersion, uint32 headerFlags, uint32 sectorSize, BOOL bWipeMode)</td></tr>
<tr class="memdesc:a25b0d6177527d33b06d34623e4f2800b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a volume header in memory.  <a href="#a25b0d6177527d33b06d34623e4f2800b">More...</a><br /></td></tr>
<tr class="separator:a25b0d6177527d33b06d34623e4f2800b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b546c4c9777de888c3b561cceb5a575"><td class="memItemLeft" align="right" valign="top">BOOL&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_volumes_8c.html#a2b546c4c9777de888c3b561cceb5a575">ReadEffectiveVolumeHeader</a> (BOOL device, HANDLE fileHandle, byte *header, DWORD *bytesRead)</td></tr>
<tr class="memdesc:a2b546c4c9777de888c3b561cceb5a575"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read the effective volume header.  <a href="#a2b546c4c9777de888c3b561cceb5a575">More...</a><br /></td></tr>
<tr class="separator:a2b546c4c9777de888c3b561cceb5a575"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb5d71c2f16d860d9bd17856804a309e"><td class="memItemLeft" align="right" valign="top">BOOL&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_volumes_8c.html#adb5d71c2f16d860d9bd17856804a309e">WriteEffectiveVolumeHeader</a> (BOOL device, HANDLE fileHandle, byte *header)</td></tr>
<tr class="memdesc:adb5d71c2f16d860d9bd17856804a309e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write the header on the device passed in parameter.  <a href="#adb5d71c2f16d860d9bd17856804a309e">More...</a><br /></td></tr>
<tr class="separator:adb5d71c2f16d860d9bd17856804a309e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31bc369dec32aaee5793685da60c640b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_volumes_8c.html#a31bc369dec32aaee5793685da60c640b">WriteRandomDataToReservedHeaderAreas</a> (HANDLE dev, <a class="el" href="struct_c_r_y_p_t_o___i_n_f_o__t.html">CRYPTO_INFO</a> *cryptoInfo, <a class="el" href="union_u_i_n_t64___s_t_r_u_c_t.html">uint64</a> dataAreaSize, BOOL bPrimaryOnly, BOOL bBackupOnly)</td></tr>
<tr class="memdesc:a31bc369dec32aaee5793685da60c640b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes randomly generated data to unused/reserved header areas. When bPrimaryOnly is TRUE, then only the primary header area (not the backup header area) is filled with random data. When bBackupOnly is TRUE, only the backup header area (not the primary header area) is filled with random data.  <a href="#a31bc369dec32aaee5793685da60c640b">More...</a><br /></td></tr>
<tr class="separator:a31bc369dec32aaee5793685da60c640b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a0e14f347f231fbddd0c003145f9dde6e"><td class="memItemLeft" align="right" valign="top"><a id="a0e14f347f231fbddd0c003145f9dde6e"></a>
BOOL&#160;</td><td class="memItemRight" valign="bottom"><b>ReadVolumeHeaderRecoveryMode</b> = FALSE</td></tr>
<tr class="separator:a0e14f347f231fbddd0c003145f9dde6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Manage the generation and use of header of volumes. </p>
<dl class="section version"><dt>Version</dt><dd>1.3.1 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>20/01/2017 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a25b0d6177527d33b06d34623e4f2800b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25b0d6177527d33b06d34623e4f2800b">&#9670;&nbsp;</a></span>CreateVolumeHeaderInMemory()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CreateVolumeHeaderInMemory </td>
          <td>(</td>
          <td class="paramtype">BOOL&#160;</td>
          <td class="paramname"><em>bBoot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>header</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_password.html">Password</a> *&#160;</td>
          <td class="paramname"><em>password</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pkcs5_prf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>masterKeydata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_c_r_y_p_t_o___i_n_f_o__t.html">PCRYPTO_INFO</a> *&#160;</td>
          <td class="paramname"><em>retInfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned __int64&#160;</td>
          <td class="paramname"><em>volumeSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned __int64&#160;</td>
          <td class="paramname"><em>hiddenVolumeSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned __int64&#160;</td>
          <td class="paramname"><em>encryptedAreaStart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned __int64&#160;</td>
          <td class="paramname"><em>encryptedAreaLength</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16&#160;</td>
          <td class="paramname"><em>requiredProgramVersion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32&#160;</td>
          <td class="paramname"><em>headerFlags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32&#160;</td>
          <td class="paramname"><em>sectorSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BOOL&#160;</td>
          <td class="paramname"><em>bWipeMode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates a volume header in memory. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">BOOL</td><td>bBoot </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">char</td><td>* header </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">int</td><td>ea </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">int</td><td>mode </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="struct_password.html">Password</a></td><td>* password </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">int</td><td>pkcs5_prf </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">char</td><td>* masterKeydata </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">PCRYPTO_INFO</td><td>* retInfo </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">unsigned</td><td>__int64 volumeSize </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">unsigned</td><td>__int64 hiddenVolumeSize </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">unsigned</td><td>__int64 encryptedAreaStart </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">unsigned</td><td>__int64 encryptedAreaLength </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">uint16</td><td>requiredProgramVersion </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">uint32</td><td>headerFlags </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">uint32</td><td>sectorSize </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">BOOL</td><td>bWipeMode </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int ERR_OUTOFMEMORY if (cryptoInfo == NULL) retval if (retVal != ERR_SUCCESS) ERR_CIPHER_INIT_WEAK_KEY if (!RandgetBytes (keyInfo.salt, PKCS5_SALT_SIZE, !bWipeMode)) ERR_CIPHER_INIT_WEAK_KEY if (!RandgetBytes (keyInfo.master_keydata, bytesNeeded, TRUE)) ERR_OUTOFMEMORY if (!EAInitMode (cryptoInfo)) 0 else </dd></dl>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="_volumes_8c_a25b0d6177527d33b06d34623e4f2800b_icgraph.png" border="0" usemap="#_volumes_8c_a25b0d6177527d33b06d34623e4f2800b_icgraph" alt=""/></div>
<map name="_volumes_8c_a25b0d6177527d33b06d34623e4f2800b_icgraph" id="_volumes_8c_a25b0d6177527d33b06d34623e4f2800b_icgraph">
<area shape="rect" id="node2" href="class_gost_crypt_1_1_boot_encryption.html#a9cce66955923f808f4dd297c7041ac5b" title="Change the password. " alt="" coords="256,5,435,47"/>
</map>
</div>

</div>
</div>
<a id="a28fc4bf9ef4c56293aa4b387541cfe5e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a28fc4bf9ef4c56293aa4b387541cfe5e">&#9670;&nbsp;</a></span>GetHeaderField16()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16 GetHeaderField16 </td>
          <td>(</td>
          <td class="paramtype">byte *&#160;</td>
          <td class="paramname"><em>header</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>offset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Getter for 16 bits value in a header, starting at the offset. </p>
<p>Legal Notice: Some portions of the source code contained in this file were derived from the source code of Encryption for the Masses 2.02a, which is Copyright (c) 1998-2000 Paul Le Roux and which is governed by the 'License Agreement for Encryption for the Masses'. Modifications and additions to the original source code (contained in this file) and all other portions of this file are Copyright (c) 2003-2010 TrueCrypt Developers Association and are governed by the TrueCrypt License 3.0 the full text of which is contained in the file License.txt included in TrueCrypt binary and source code distribution packages.</p>
<p>Volume header v5 structure (used since GostCrypt 7.0):</p>
<h2>Offset Length Description </h2>
<p>Unencrypted: 0 64 Salt Encrypted: 64 4 ASCII string 'TRUE' 68 2 Header version 70 2 Required program version 72 4 CRC-32 checksum of the (decrypted) bytes 256-511 76 16 Reserved (must contain zeroes) 92 8 Size of hidden volume in bytes (0 = normal volume) 100 8 Size of the volume in bytes (identical with field 92 for hidden volumes, valid if field 70 &gt;= 0x600 or flag bit 0 == 1) 108 8 Byte offset of the start of the master key scope (valid if field 70 &gt;= 0x600 or flag bit 0 == 1) 116 8 Size of the encrypted area within the master key scope (valid if field 70 &gt;= 0x600 or flag bit 0 == 1) 124 4 Flags: bit 0 set = system encryption; bit 1 set = non-system in-place encryption, bits 2-31 are reserved (set to zero) 128 4 Sector size in bytes 132 120 Reserved (must contain zeroes) 252 4 CRC-32 checksum of the (decrypted) bytes 64-251 256 256 Concatenated primary master key(s) and secondary master key(s) (XTS mode)</p>
<p>Deprecated/legacy volume header v4 structure (used by GostCrypt 6.x):</p>
<h2>Offset Length Description </h2>
<p>Unencrypted: 0 64 Salt Encrypted: 64 4 ASCII string 'TRUE' 68 2 Header version 70 2 Required program version 72 4 CRC-32 checksum of the (decrypted) bytes 256-511 76 16 Reserved (must contain zeroes) 92 8 Size of hidden volume in bytes (0 = normal volume) 100 8 Size of the volume in bytes (identical with field 92 for hidden volumes, valid if field 70 &gt;= 0x600 or flag bit 0 == 1) 108 8 Byte offset of the start of the master key scope (valid if field 70 &gt;= 0x600 or flag bit 0 == 1) 116 8 Size of the encrypted area within the master key scope (valid if field 70 &gt;= 0x600 or flag bit 0 == 1) 124 4 Flags: bit 0 set = system encryption; bit 1 set = non-system in-place encryption, bits 2-31 are reserved 128 124 Reserved (must contain zeroes) 252 4 CRC-32 checksum of the (decrypted) bytes 64-251 256 256 Concatenated primary master key(s) and secondary master key(s) (XTS mode)</p>
<p>Deprecated/legacy volume header v3 structure (used by GostCrypt 5.x):</p>
<h2>Offset Length Description </h2>
<p>Unencrypted: 0 64 Salt Encrypted: 64 4 ASCII string 'TRUE' 68 2 Header version 70 2 Required program version 72 4 CRC-32 checksum of the (decrypted) bytes 256-511 76 8 Volume creation time 84 8 Header creation time 92 8 Size of hidden volume in bytes (0 = normal volume) 100 8 Size of the volume in bytes (identical with field 92 for hidden volumes) 108 8 Start byte offset of the encrypted area of the volume 116 8 Size of the encrypted area of the volume in bytes 124 132 Reserved (must contain zeroes) 256 256 Concatenated primary master key(s) and secondary master key(s) (XTS mode)</p>
<p>Deprecated/legacy volume header v2 structure (used before GostCrypt 5.0):</p>
<h2>Offset Length Description </h2>
<p>Unencrypted: 0 64 Salt Encrypted: 64 4 ASCII string 'TRUE' 68 2 Header version 70 2 Required program version 72 4 CRC-32 checksum of the (decrypted) bytes 256-511 76 8 Volume creation time 84 8 Header creation time 92 8 Size of hidden volume in bytes (0 = normal volume) 100 156 Reserved (must contain zeroes) 256 32 For LRW (deprecated/legacy), secondary key For CBC (deprecated/legacy), data used to generate IV and whitening values 288 224 Master key(s)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">int</td><td>offset </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">byte</td><td>* header </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>uint16 BE16 (*(uint16 *) (header + offset)) </dd></dl>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="_volumes_8c_a28fc4bf9ef4c56293aa4b387541cfe5e_icgraph.png" border="0" usemap="#_volumes_8c_a28fc4bf9ef4c56293aa4b387541cfe5e_icgraph" alt=""/></div>
<map name="_volumes_8c_a28fc4bf9ef4c56293aa4b387541cfe5e_icgraph" id="_volumes_8c_a28fc4bf9ef4c56293aa4b387541cfe5e_icgraph">
<area shape="rect" id="node2" href="_volumes_8c.html#afa713bf1fa27171e0cc0aa16218fe10e" title="Read the volume header using getter from 16 to 64 bits. It permits to load the volume with its parame..." alt="" coords="180,42,317,69"/>
<area shape="rect" id="node3" href="class_gost_crypt_1_1_boot_encryption.html#a9cce66955923f808f4dd297c7041ac5b" title="Change the password. " alt="" coords="369,5,548,47"/>
<area shape="rect" id="node4" href="_cache_8c.html#adf059051b371da0777591dc451201226" title="Attempt to recognize volume using the mount password. " alt="" coords="365,71,552,98"/>
</map>
</div>

</div>
</div>
<a id="aeb33f14ce64d22f64717b2b2a92da656"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb33f14ce64d22f64717b2b2a92da656">&#9670;&nbsp;</a></span>GetHeaderField32()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32 GetHeaderField32 </td>
          <td>(</td>
          <td class="paramtype">byte *&#160;</td>
          <td class="paramname"><em>header</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>offset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Getter for 32 bits value in a header, starting at the offset. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">int</td><td>offset </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">byte</td><td>* header </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BE32 (*(uint32 *) (header + offset)) </dd></dl>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="_volumes_8c_aeb33f14ce64d22f64717b2b2a92da656_icgraph.png" border="0" usemap="#_volumes_8c_aeb33f14ce64d22f64717b2b2a92da656_icgraph" alt=""/></div>
<map name="_volumes_8c_aeb33f14ce64d22f64717b2b2a92da656_icgraph" id="_volumes_8c_aeb33f14ce64d22f64717b2b2a92da656_icgraph">
<area shape="rect" id="node2" href="_volumes_8c.html#afa713bf1fa27171e0cc0aa16218fe10e" title="Read the volume header using getter from 16 to 64 bits. It permits to load the volume with its parame..." alt="" coords="180,42,317,69"/>
<area shape="rect" id="node3" href="class_gost_crypt_1_1_boot_encryption.html#a9cce66955923f808f4dd297c7041ac5b" title="Change the password. " alt="" coords="369,5,548,47"/>
<area shape="rect" id="node4" href="_cache_8c.html#adf059051b371da0777591dc451201226" title="Attempt to recognize volume using the mount password. " alt="" coords="365,71,552,98"/>
</map>
</div>

</div>
</div>
<a id="ab4f7e46232fce9725756858d64edbf1b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab4f7e46232fce9725756858d64edbf1b">&#9670;&nbsp;</a></span>GetHeaderField64()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="union_u_i_n_t64___s_t_r_u_c_t.html">UINT64_STRUCT</a> GetHeaderField64 </td>
          <td>(</td>
          <td class="paramtype">byte *&#160;</td>
          <td class="paramname"><em>header</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>offset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Getter for 64 bits value in a header, starting at the offset. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">int</td><td>offset </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">byte</td><td>* header </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="union_u_i_n_t64___s_t_r_u_c_t.html">UINT64_STRUCT</a> uint64Struct </dd></dl>

</div>
</div>
<a id="a2b546c4c9777de888c3b561cceb5a575"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b546c4c9777de888c3b561cceb5a575">&#9670;&nbsp;</a></span>ReadEffectiveVolumeHeader()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOL ReadEffectiveVolumeHeader </td>
          <td>(</td>
          <td class="paramtype">BOOL&#160;</td>
          <td class="paramname"><em>device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">HANDLE&#160;</td>
          <td class="paramname"><em>fileHandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">byte *&#160;</td>
          <td class="paramname"><em>header</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DWORD *&#160;</td>
          <td class="paramname"><em>bytesRead</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read the effective volume header. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">DWORD</td><td>* bytesRead </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">byte</td><td>* header </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">HANDLE</td><td>fileHandle </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">BOOL</td><td>device </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOL FALSE if (!DeviceIoControl (fileHandle, IOCTL_DISK_GET_DRIVE_GEOMETRY, NULL, 0, &amp;geometry, sizeof (geometry), bytesRead, NULL)) FALSE if (geometry.BytesPerSector &gt; sizeof (sectorBuffer) || geometry.BytesPerSector &lt; GST_MIN_VOLUME_SECTOR_SIZE) FALSE if (!ReadFile (fileHandle, sectorBuffer, max (GST_VOLUME_HEADER_EFFECTIVE_SIZE, geometry.BytesPerSector), bytesRead, NULL)) TRUE else </dd></dl>

</div>
</div>
<a id="afa713bf1fa27171e0cc0aa16218fe10e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa713bf1fa27171e0cc0aa16218fe10e">&#9670;&nbsp;</a></span>ReadVolumeHeader()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ReadVolumeHeader </td>
          <td>(</td>
          <td class="paramtype">BOOL&#160;</td>
          <td class="paramname"><em>bBoot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>encryptedHeader</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_password.html">Password</a> *&#160;</td>
          <td class="paramname"><em>password</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_c_r_y_p_t_o___i_n_f_o__t.html">PCRYPTO_INFO</a> *&#160;</td>
          <td class="paramname"><em>retInfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_c_r_y_p_t_o___i_n_f_o__t.html">CRYPTO_INFO</a> *&#160;</td>
          <td class="paramname"><em>retHeaderCryptoInfo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read the volume header using getter from 16 to 64 bits. It permits to load the volume with its parameters. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">CRYPTO_INFO</td><td>* retHeaderCryptoInfo </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">PCRYPTO_INFO</td><td>* retInfo </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="struct_password.html">Password</a></td><td>* password </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">char</td><td>* encryptedHeader </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">BOOL</td><td>bBoot </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int ERR_OUTOFMEMORY if (encryptionThreadCount &gt; 1) ERR_OUTOFMEMORY else (retHeaderCryptoInfo != NULL) ERR_OUTOFMEMORY if (!keyDerivationCompletedEvent) ERR_OUROFMEMORY if (!noOutstandingWorkItemEvent) ERR_PARAMETER_INCORRECT if (cryptoInfo-&gt;SectorSize &lt; GST_MIN_VOLUME_SECTOR_SIZE || cryptoInfo-&gt;SectorSize &gt; GST_MAX_VOLUME_SECTOR_SIZE || cryptoInfo-&gt;SectorSize % ENCRYPTION_DATA_UNIT_SIZE != 0) ERR_MODE_INIT_FAILED if (!EAInitMode (cryptoInfo)) ERR_NEW_VERSION_REQUIRED if (headerVersion &gt; VOLUME_HEADER_VERSION) ERR_NEW_VERSION_REQUIRED if (cryptoInfo-&gt;RequiredProgramVersion &gt; VERSION_NUM) ERR_CIPHER_INIT_FAILURE if (status == ERR_CIPHER_INIT_FAILURE) ERR_MODE_INIT_FAILED if (!EAInitMode (cryptoInfo)) status else </dd></dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="_volumes_8c_afa713bf1fa27171e0cc0aa16218fe10e_cgraph.png" border="0" usemap="#_volumes_8c_afa713bf1fa27171e0cc0aa16218fe10e_cgraph" alt=""/></div>
<map name="_volumes_8c_afa713bf1fa27171e0cc0aa16218fe10e_cgraph" id="_volumes_8c_afa713bf1fa27171e0cc0aa16218fe10e_cgraph">
<area shape="rect" id="node2" href="_encryption_thread_pool_8c.html#a461a5a13d91d6fb689e91a37a3b67c72" title="Getter for the number of thread running. " alt="" coords="193,127,371,153"/>
<area shape="rect" id="node3" href="_crypto_8c.html#a2d26a3fd98da719962f2db2a8e4548fe" title="Do the crypto. " alt="" coords="235,177,329,204"/>
<area shape="rect" id="node4" href="_crypto_8c.html#a22c39678f0546cc7272ccbdcb105067a" title="Load the key. " alt="" coords="227,228,337,255"/>
<area shape="rect" id="node5" href="_encryption_thread_pool_8c.html#a981f3c0914f749f330430832c7606a6f" title="Start the encryption key using the key chosed by the user. " alt="" coords="191,279,373,321"/>
<area shape="rect" id="node6" href="_pkcs5_8c.html#aee4d5556601a2d1303f48901e7c16f55" title="Getter for the iteration count of the pksc5. " alt="" coords="215,345,349,386"/>
<area shape="rect" id="node7" href="_pkcs5_8c.html#a8ff824bd676357439142d52ce0283c65" title="Change the blocks of the key iteratively. " alt="" coords="212,411,352,437"/>
<area shape="rect" id="node8" href="_crypto_8c.html#aaed9b2d5a4b22439e8646cda3f0db1aa" title="Returns the maximum number of bytes necessary to be generated by the PBKDF2 (PKCS #5) ..." alt="" coords="206,563,358,589"/>
<area shape="rect" id="node22" href="_crypto_8c.html#a0b429fab7dfd8ef48d2ab835596004f0" title="Get first EA (half useless) " alt="" coords="467,56,554,83"/>
<area shape="rect" id="node23" href="_crypto_8c.html#a0746793b59acd1220c830d926d2b9e37" title="Get the next EA. " alt="" coords="467,107,555,133"/>
<area shape="rect" id="node24" href="_crypto_8c.html#a3616fd7fa35d83ea0e0cb8140e0f306a" title="Return values: 0 = success, ERR_CIPHER_INIT_FAILURE (fatal), ERR_CIPHER_INIT_WEAK_KEY (non&#45;fatal) ..." alt="" coords="482,740,539,767"/>
<area shape="rect" id="node25" href="_crypto_8c.html#abfc3043d94e0df6ce41e98025352b885" title="Return the first EA. " alt="" coords="921,613,1045,640"/>
<area shape="rect" id="node33" href="_crypto_8c.html#a716b0bb692231cf71d1f95878e45096c" title="Returns sum of key sizes of all ciphers of the EA (in bytes) " alt="" coords="455,613,566,640"/>
<area shape="rect" id="node39" href="_crypto_8c.html#adf61d3050038714fbf5f958453f4c68a" title="buf: data to be decrypted; the start of the buffer is assumed to be aligned with the start of a data ..." alt="" coords="461,1019,561,1045"/>
<area shape="rect" id="node44" href="_pkcs5_8c.html#aac1e0891a72ae792abca9529fbf9ef28" title="Derive the stribog key (cahnge the bits iteratively) " alt="" coords="217,816,347,843"/>
<area shape="rect" id="node45" href="_pkcs5_8c.html#a4fdd0af868701442216b4c99cc127087" title="Make the derivative of the key (iterate and change bits in it) " alt="" coords="211,867,353,893"/>
<area shape="rect" id="node46" href="_crypto_8c.html#a80fb3f1fabf0d3130523f112ae629ca8" title="Returns TRUE if the mode of operation is supported for the encryption algorithm. " alt="" coords="211,917,353,944"/>
<area shape="rect" id="node47" href="_crypto_8c.html#a794038e7ead3d5533e3134ce20e93a39" title="Get the block size of a cipher at id. " alt="" coords="914,1120,1053,1147"/>
<area shape="rect" id="node48" href="_crypto_8c.html#adc26e07453b54c9f9f7b14a2703b5f60" title="Initialize EA mode. " alt="" coords="237,715,327,741"/>
<area shape="rect" id="node49" href="_volumes_8c.html#aeb33f14ce64d22f64717b2b2a92da656" title="Getter for 32 bits value in a header, starting at the offset. " alt="" coords="219,1272,345,1299"/>
<area shape="rect" id="node50" href="_volumes_8c.html#a28fc4bf9ef4c56293aa4b387541cfe5e" title="Getter for 16 bits value in a header, starting at the offset. " alt="" coords="219,1323,345,1349"/>
<area shape="rect" id="node9" href="_crypto_8c.html#a992cf30eac8c4f60ca59f7d08609db88" title="Returns the largest key size needed by an EA for the specified mode of operation. ..." alt="" coords="421,411,600,437"/>
<area shape="rect" id="node10" href="_crypto_8c.html#a31f3ed0da669e630ba1fe809a652c177" title="Encipher one block. " alt="" coords="693,56,799,83"/>
<area shape="rect" id="node16" href="_crypto_8c.html#ac328d60e48a816bf710bbc24abfd3bd6" title="Is Aes Hardware cpu supported. " alt="" coords="433,512,588,539"/>
<area shape="rect" id="node17" href="_crypto_8c.html#a89fad765275f1cf31dcf603157ea77bf" title="Decipher one block. " alt="" coords="457,208,564,235"/>
<area shape="rect" id="node34" href="_crypto_8c.html#aae913410eb90f16a1ca4021032880ead" title="buf: data to be encrypted; the start of the buffer is assumed to be aligned with the start of a data ..." alt="" coords="461,461,561,488"/>
<area shape="rect" id="node35" href="_xts_8c.html#aad9147213002ffaa3c0450853005e646" title="length: number of bytes to encrypt; may be larger than one data unit and must be divisible by the cip..." alt="" coords="685,259,807,285"/>
<area shape="rect" id="node36" href="_xts_8c.html#af9db6f7d5ac83732ee40cfdf0ca69e16" title="The goal is to switch some byte of a encrypted data with the next encrypted data. This doesn&#39;t hurt t..." alt="" coords="667,309,825,336"/>
<area shape="rect" id="node37" href="_crypto_8c.html#a143fe9aa7d1bc0533f4262974e9fa984" title="buf: data to be encrypted unitNo: sequential number of the data unit with which the buffer starts nbr..." alt="" coords="449,259,573,285"/>
<area shape="rect" id="node43" href="_xts_8c.html#acf61facb05a3ea253498a379275f48a6" title="For descriptions of the input parameters, see EncryptBufferXTS(). Decrypt before switching back the d..." alt="" coords="685,1019,807,1045"/>
<area shape="rect" id="node11" href="_gost_cipher_8c.html#a5c4472de500c6aa8f73dd9d0418aa4f0" title="Encrypt with gost algorithm. " alt="" coords="935,5,1032,32"/>
<area shape="rect" id="node12" href="_grasshopper_cipher_8c.html#a8a03545392da4eb01f3fcd5197d42444" title="Encryption procedure. " alt="" coords="912,56,1055,83"/>
<area shape="rect" id="node13" href="_grasshopper_cipher_8c.html#a6107e1c52141eb86bb87182173247783" title="Switch opposed bytes (lower byte to upper byte, ...) of unsigned long. " alt="" coords="1123,208,1227,235"/>
<area shape="rect" id="node14" href="_grasshopper_cipher_8c.html#ad7ac77c93d4d2a4f28cf4f053605bef0" title="L conversion (16 iteration of R) " alt="" coords="1275,208,1313,235"/>
<area shape="rect" id="node15" href="_grasshopper_cipher_8c.html#a56efe30edac1e0cce6167cb840c2e470" title="Apply S conversion. " alt="" coords="1155,56,1194,83"/>
<area shape="rect" id="node18" href="_gost_cipher_8c.html#a58ce7997f812d09cdb40f8b5ea448acb" title="Decrypt with gost algorithm. " alt="" coords="697,157,795,184"/>
<area shape="rect" id="node19" href="_grasshopper_cipher_8c.html#aaaba43e85bfee3b0522a31774f6072c5" title="Decryption procedure. " alt="" coords="675,107,817,133"/>
<area shape="rect" id="node20" href="_grasshopper_cipher_8c.html#a6ea6ff18be6c29236c40ab2b0818c18e" title="Inverse of L conversion (16 iteration of R_inv) " alt="" coords="958,157,1009,184"/>
<area shape="rect" id="node21" href="_grasshopper_cipher_8c.html#a46436dc8b92d9ad643ef443af3392e27" title="Inverse of S conversion. " alt="" coords="957,107,1010,133"/>
<area shape="rect" id="node26" href="_crypto_8c.html#a162e231ed99c4a3fa4caa50d66703d28" title="Return next cipher if exists. " alt="" coords="921,461,1046,488"/>
<area shape="rect" id="node27" href="_crypto_8c.html#aa38ecf7977d369eb9f080b1498e48738" title="Initialise cipher Return values: 0 = success, ERR_CIPHER_INIT_FAILURE (fatal), ERR_CIPHER_INIT_WEAK_K..." alt="" coords="708,816,784,843"/>
<area shape="rect" id="node30" href="_crypto_8c.html#ad395a0b04fac58cda3188c2559ae46dd" title="Get the key size of a cipher at id. " alt="" coords="681,968,811,995"/>
<area shape="rect" id="node32" href="_crypto_8c.html#a3dd093c42e7b7351c23317efacc57221" title="Get the key schedule size of a cipher at id. " alt="" coords="892,917,1075,944"/>
<area shape="rect" id="node28" href="_gost_cipher_8c.html#a894c8f0e07a5614968fca09f7ae1f24b" title="Set the gost key Generate a pseudo random data (based on the key) and set the key. " alt="" coords="933,816,1033,843"/>
<area shape="rect" id="node29" href="_grasshopper_cipher_8c.html#a6b136aade799131cab66db1d5d4df8b0" title="Key setup procedure. " alt="" coords="910,664,1057,691"/>
<area shape="rect" id="node31" href="_crypto_8c.html#a497fc6204c6a611434f38e4ccec909db" title="Get cipher at id, return null if there is no cipher with this id. " alt="" coords="1135,968,1215,995"/>
<area shape="rect" id="node38" href="_encryption_thread_pool_8c.html#abb01516958dcdb87a96eea999242e434" title="Start the encryption key into the thread pool. Each thread encrypt or decrypt small amount of data..." alt="" coords="648,208,844,235"/>
<area shape="rect" id="node40" href="_crypto_8c.html#aca3647cdf6774c8ce5ba2b0c2f370bd1" title="Returns sum of key schedule sizes of all ciphers of the EA. " alt="" coords="664,765,828,792"/>
<area shape="rect" id="node41" href="_crypto_8c.html#ac51b1aa192c121136917d07e628b3b62" title="Get last EA cipher. " alt="" coords="685,1120,807,1147"/>
<area shape="rect" id="node42" href="_crypto_8c.html#a7c61a17a983733f94fa7ec56fed30740" title="Return next cipher if exists. " alt="" coords="673,1171,819,1197"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="_volumes_8c_afa713bf1fa27171e0cc0aa16218fe10e_icgraph.png" border="0" usemap="#_volumes_8c_afa713bf1fa27171e0cc0aa16218fe10e_icgraph" alt=""/></div>
<map name="_volumes_8c_afa713bf1fa27171e0cc0aa16218fe10e_icgraph" id="_volumes_8c_afa713bf1fa27171e0cc0aa16218fe10e_icgraph">
<area shape="rect" id="node2" href="class_gost_crypt_1_1_boot_encryption.html#a9cce66955923f808f4dd297c7041ac5b" title="Change the password. " alt="" coords="195,5,373,47"/>
<area shape="rect" id="node3" href="_cache_8c.html#adf059051b371da0777591dc451201226" title="Attempt to recognize volume using the mount password. " alt="" coords="191,71,377,98"/>
</map>
</div>

</div>
</div>
<a id="adb5d71c2f16d860d9bd17856804a309e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb5d71c2f16d860d9bd17856804a309e">&#9670;&nbsp;</a></span>WriteEffectiveVolumeHeader()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOL WriteEffectiveVolumeHeader </td>
          <td>(</td>
          <td class="paramtype">BOOL&#160;</td>
          <td class="paramname"><em>device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">HANDLE&#160;</td>
          <td class="paramname"><em>fileHandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">byte *&#160;</td>
          <td class="paramname"><em>header</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write the header on the device passed in parameter. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">byte</td><td>* header </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">HANDLE</td><td>fileHandle </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">BOOL</td><td>device </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOL TRUE if (!device) FALSE if (!WriteFile (fileHandle, header, GST_VOLUME_HEADER_EFFECTIVE_SIZE, &amp;bytesDone, NULL)) FALSE if (bytesDone != GST_VOLUME_HEADER_EFFECTIVE_SIZE) FALSE if (!DeviceIoControl (fileHandle, IOCTL_DISK_GET_DRIVE_GEOMETRY, NULL, 0, &amp;geometry, sizeof (geometry), &amp;bytesDone, NULL)) FALSE if (geometry.BytesPerSector &gt; sizeof (sectorBuffer) || geometry.BytesPerSector &lt; GST_MIN_VOLUME_SECTOR_SIZE) FALSE if (!ReadFile (fileHandle, sectorBuffer, geometry.BytesPerSector, &amp;bytesDone, NULL) &amp;&amp; (geometry.BytesPerSector != GST_VOLUME_HEADER_EFFECTIVE_SIZE)) FALSE if (bytesDone != geometry.BytesPerSector &amp;&amp; (geometry.BytesPerSector != GST_VOLUME_HEADER_EFFECTIVE_SIZE)) FALSE if (!SetFilePointerEx (fileHandle, seekOffset, NULL, FILE_CURRENT) &amp;&amp; (geometry.BytesPerSector != GST_VOLUME_HEADER_EFFECTIVE_SIZE)) FALSE if (!WriteFile (fileHandle, sectorBuffer, geometry.BytesPerSector, &amp;bytesDone, NULL) &amp;&amp; (geometry.BytesPerSector != GST_VOLUME_HEADER_EFFECTIVE_SIZE)) FALSE if (bytesDone != geometry.BytesPerSector) TRUE else </dd></dl>

</div>
</div>
<a id="a31bc369dec32aaee5793685da60c640b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31bc369dec32aaee5793685da60c640b">&#9670;&nbsp;</a></span>WriteRandomDataToReservedHeaderAreas()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int WriteRandomDataToReservedHeaderAreas </td>
          <td>(</td>
          <td class="paramtype">HANDLE&#160;</td>
          <td class="paramname"><em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_c_r_y_p_t_o___i_n_f_o__t.html">CRYPTO_INFO</a> *&#160;</td>
          <td class="paramname"><em>cryptoInfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="union_u_i_n_t64___s_t_r_u_c_t.html">uint64</a>&#160;</td>
          <td class="paramname"><em>dataAreaSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BOOL&#160;</td>
          <td class="paramname"><em>bPrimaryOnly</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BOOL&#160;</td>
          <td class="paramname"><em>bBackupOnly</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Writes randomly generated data to unused/reserved header areas. When bPrimaryOnly is TRUE, then only the primary header area (not the backup header area) is filled with random data. When bBackupOnly is TRUE, only the backup header area (not the primary header area) is filled with random data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">BOOL</td><td>bBackupOnly </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">BOOL</td><td>bPrimaryOnly </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">uint64</td><td>dataAreaSize </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">CRYPTO_INFO</td><td>* cryptoInfo </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">HANDLE</td><td>dev </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int ERR_PARAMETER_INCORRECT if (!RandgetBytes (temporaryKey, EAGetKeySize (cryptoInfo-&gt;ea), FALSE) || !RandgetBytes (cryptoInfo-&gt;k2, sizeof (cryptoInfo-&gt;k2), FALSE)) ERR_MODE_INIT_FAILED if (!EAInitMode (cryptoInfo)) ERR_OS_ERROR if (!ReadFile (dev, buf, sizeof (buf), &amp;bytesDone, NULL)) ERR_OS_ERROR if (!SetFilePointerEx (dev, offset, NULL, FILE_BEGIN)) ERR_OS_ERROR if (bytesDone &lt; GST_VOLUME_HEADER_EFFECTIVE_SIZE) ERR_OS_ERROR if (!SetFilePointerEx (dev, offset, NULL, FILE_BEGIN)) ERR_OS_ERROR if (bytesDone &lt; GST_VOLUME_HEADER_EFFECTIVE_SIZE) ERR_PARAMETER_INCORRECT if (bytesDone != sizeof (buf)) ERR_MODE_INIT_FAILED if (!EAInitMode (cryptoInfo)) nStatus else </dd></dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="_volumes_8c_a31bc369dec32aaee5793685da60c640b_cgraph.png" border="0" usemap="#_volumes_8c_a31bc369dec32aaee5793685da60c640b_cgraph" alt=""/></div>
<map name="_volumes_8c_a31bc369dec32aaee5793685da60c640b_cgraph" id="_volumes_8c_a31bc369dec32aaee5793685da60c640b_cgraph">
<area shape="rect" id="node2" href="_random_8c.html#a4f9073a1b47a63a40fed7a2b39ea63d2" title="Get len random bytes from the pool (max. RNG_POOL_SIZE bytes per a single call) " alt="" coords="248,81,352,108"/>
<area shape="rect" id="node3" href="_crypto_8c.html#a716b0bb692231cf71d1f95878e45096c" title="Returns sum of key sizes of all ciphers of the EA (in bytes) " alt="" coords="400,233,511,260"/>
<area shape="rect" id="node8" href="_crypto_8c.html#a3616fd7fa35d83ea0e0cb8140e0f306a" title="Return values: 0 = success, ERR_CIPHER_INIT_FAILURE (fatal), ERR_CIPHER_INIT_WEAK_KEY (non&#45;fatal) ..." alt="" coords="427,183,484,209"/>
<area shape="rect" id="node18" href="_crypto_8c.html#adc26e07453b54c9f9f7b14a2703b5f60" title="Initialize EA mode. " alt="" coords="255,132,345,159"/>
<area shape="rect" id="node19" href="_crypto_8c.html#aae913410eb90f16a1ca4021032880ead" title="buf: data to be encrypted; the start of the buffer is assumed to be aligned with the start of a data ..." alt="" coords="405,284,505,311"/>
<area shape="rect" id="node4" href="_crypto_8c.html#abfc3043d94e0df6ce41e98025352b885" title="Return the first EA. " alt="" coords="588,183,712,209"/>
<area shape="rect" id="node5" href="_crypto_8c.html#ad395a0b04fac58cda3188c2559ae46dd" title="Get the key size of a cipher at id. " alt="" coords="585,132,715,159"/>
<area shape="rect" id="node7" href="_crypto_8c.html#a162e231ed99c4a3fa4caa50d66703d28" title="Return next cipher if exists. " alt="" coords="587,233,713,260"/>
<area shape="rect" id="node6" href="_crypto_8c.html#a497fc6204c6a611434f38e4ccec909db" title="Get cipher at id, return null if there is no cipher with this id. " alt="" coords="823,208,903,235"/>
<area shape="rect" id="node9" href="_crypto_8c.html#aa38ecf7977d369eb9f080b1498e48738" title="Initialise cipher Return values: 0 = success, ERR_CIPHER_INIT_FAILURE (fatal), ERR_CIPHER_INIT_WEAK_K..." alt="" coords="612,81,688,108"/>
<area shape="rect" id="node17" href="_crypto_8c.html#a3dd093c42e7b7351c23317efacc57221" title="Get the key schedule size of a cipher at id. " alt="" coords="559,284,741,311"/>
<area shape="rect" id="node10" href="_gost_cipher_8c.html#a894c8f0e07a5614968fca09f7ae1f24b" title="Set the gost key Generate a pseudo random data (based on the key) and set the key. " alt="" coords="813,107,913,133"/>
<area shape="rect" id="node11" href="_grasshopper_cipher_8c.html#a6b136aade799131cab66db1d5d4df8b0" title="Key setup procedure. " alt="" coords="789,56,936,83"/>
<area shape="rect" id="node12" href="_grasshopper_cipher_8c.html#ad7ac77c93d4d2a4f28cf4f053605bef0" title="L conversion (16 iteration of R) " alt="" coords="1136,31,1175,57"/>
<area shape="rect" id="node15" href="_grasshopper_cipher_8c.html#a6107e1c52141eb86bb87182173247783" title="Switch opposed bytes (lower byte to upper byte, ...) of unsigned long. " alt="" coords="984,5,1088,32"/>
<area shape="rect" id="node16" href="_grasshopper_cipher_8c.html#acea73ea2211a8c6ff219e586d742d99f" title="F conversion (used in key setup) " alt="" coords="1017,107,1055,133"/>
<area shape="rect" id="node13" href="_grasshopper_cipher_8c.html#abb3e0356548dd4a7ddefbb57b5255eb6" title="Apply R conversion. " alt="" coords="1223,31,1261,57"/>
<area shape="rect" id="node14" href="_grasshopper_cipher_8c.html#a6cbf3c8e29c4398a3dc1fa13e979da17" title="Get conversion value. " alt="" coords="1309,31,1348,57"/>
<area shape="rect" id="node20" href="_xts_8c.html#aad9147213002ffaa3c0450853005e646" title="length: number of bytes to encrypt; may be larger than one data unit and must be divisible by the cip..." alt="" coords="589,385,711,412"/>
<area shape="rect" id="node21" href="_xts_8c.html#af9db6f7d5ac83732ee40cfdf0ca69e16" title="The goal is to switch some byte of a encrypted data with the next encrypted data. This doesn&#39;t hurt t..." alt="" coords="571,335,729,361"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
