\hypertarget{_self_extract_8c}{}\section{Setup/\+Self\+Extract.c File Reference}
\label{_self_extract_8c}\index{Setup/\+Self\+Extract.\+c@{Setup/\+Self\+Extract.\+c}}


The extractor for the executable files.  


{\ttfamily \#include \char`\"{}Gstdefs.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Inflate.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Self\+Extract.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Wizard.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Setup.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Crc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Endian.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Dlgcode.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Dir.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Language.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Resource.\+h\char`\"{}}\newline
Include dependency graph for Self\+Extract.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{_self_extract_8c__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{_self_extract_8c_af49c88ddbb3a4994e5b9eeb5fcdfebf5}{Output\+Package\+File}~\char`\"{}Gost\+Crypt Setup \char`\"{} V\+E\+R\+S\+I\+O\+N\+\_\+\+S\+T\+R\+I\+NG \char`\"{}.exe\char`\"{}
\item 
\mbox{\Hypertarget{_self_extract_8c_a8dbad047c704131391590e7c07a7dc0a}\label{_self_extract_8c_a8dbad047c704131391590e7c07a7dc0a}} 
\#define {\bfseries M\+A\+G\+\_\+\+S\+T\+A\+R\+T\+\_\+\+M\+A\+R\+K\+ER}~\char`\"{}G\+S\+T\+I\+N\+S\+T\+RT\char`\"{}
\item 
\mbox{\Hypertarget{_self_extract_8c_aaa15dbbd33ad587bb846d3f805f291e8}\label{_self_extract_8c_aaa15dbbd33ad587bb846d3f805f291e8}} 
\#define {\bfseries M\+A\+G\+\_\+\+E\+N\+D\+\_\+\+M\+A\+R\+K\+E\+R\+\_\+\+O\+B\+F\+U\+S\+C\+A\+T\+ED}~\char`\"{}T/C/I/N/\hyperlink{_grasshopper_cipher_8c_a56efe30edac1e0cce6167cb840c2e470}{S}/C/\hyperlink{_grasshopper_cipher_8c_abb3e0356548dd4a7ddefbb57b5255eb6}{R}/C\char`\"{}
\item 
\mbox{\Hypertarget{_self_extract_8c_ab5d58a3d3460d5837e68011a78a3b2a5}\label{_self_extract_8c_ab5d58a3d3460d5837e68011a78a3b2a5}} 
\#define {\bfseries P\+I\+P\+E\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+L\+EN}~(4 $\ast$ B\+Y\+T\+E\+S\+\_\+\+P\+E\+R\+\_\+\+KB)
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{_self_extract_8c_a15db30754007bf6fe4db42c07794e12c}{Self\+Extract\+Startup\+Init} (void)
\begin{DoxyCompactList}\small\item\em Call a deobfuscation function. \end{DoxyCompactList}\item 
B\+O\+OL \hyperlink{_self_extract_8c_aaf592c04ff2d8c23f59dba3079741b91}{Make\+Self\+Extracting\+Package} (H\+W\+ND hwnd\+Dlg, char $\ast$sz\+Dest\+Dir)
\begin{DoxyCompactList}\small\item\em Make a compressed extracted package to launch the program, in the folder sz\+Dest\+Dir and named thanks to Get\+Module\+File\+Name sz\+Dest\+Dir is the directories that contains setup files then load them. \end{DoxyCompactList}\item 
B\+O\+OL \hyperlink{_self_extract_8c_a64d92ae937dd021686b6fbed6dc6a572}{Verify\+Package\+Integrity} (void)
\begin{DoxyCompactList}\small\item\em Verifies the C\+R\+C-\/32 of the whole self-\/extracting package (except the digital signature areas, if present) \end{DoxyCompactList}\item 
B\+O\+OL \hyperlink{_self_extract_8c_a2e765d66b3347c746e801dfa3b3fa0bc}{Is\+Self\+Extracting\+Package} (void)
\begin{DoxyCompactList}\small\item\em Determines whether we are a self-\/extracting package. \end{DoxyCompactList}\item 
B\+O\+OL \hyperlink{_self_extract_8c_a971f4b820217d5ad5e2039a4195bfd21}{Self\+Extract\+In\+Memory} (char $\ast$path)
\begin{DoxyCompactList}\small\item\em Assumes that \hyperlink{_self_extract_8c_a64d92ae937dd021686b6fbed6dc6a572}{Verify\+Package\+Integrity()} has been used. Returns T\+R\+UE, if successful (otherwise F\+A\+L\+SE). Creates a table of pointers to buffers containing the following objects for each file\+: filename size, filename (not null-\/terminated!), file size, file C\+R\+C-\/32, uncompressed file contents. For details, see the definition of the \hyperlink{struct_d_e_c_o_m_p_r_e_s_s_e_d___f_i_l_e}{D\+E\+C\+O\+M\+P\+R\+E\+S\+S\+E\+D\+\_\+\+F\+I\+LE} structure. \end{DoxyCompactList}\item 
void \+\_\+\+\_\+cdecl \hyperlink{_self_extract_8c_ac03cfb6cd4ef918739df00c094019313}{Extract\+All\+Files\+Thread} (void $\ast$hwnd\+Dlg)
\begin{DoxyCompactList}\small\item\em This function (that seems called as a thread) to extract the executable files, send a message if successed or failed. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{_self_extract_8c_aa6a168f085442da14c744f9dbf7add3a}\label{_self_extract_8c_aa6a168f085442da14c744f9dbf7add3a}} 
unsigned char {\bfseries Mag\+End\+Marker} \mbox{[}sizeof(M\+A\+G\+\_\+\+E\+N\+D\+\_\+\+M\+A\+R\+K\+E\+R\+\_\+\+O\+B\+F\+U\+S\+C\+A\+T\+ED)\mbox{]}
\item 
\mbox{\Hypertarget{_self_extract_8c_a6dc224a869d9954fd2c5f30284f4bf94}\label{_self_extract_8c_a6dc224a869d9954fd2c5f30284f4bf94}} 
char {\bfseries Dest\+Extract\+Path} \mbox{[}G\+S\+T\+\_\+\+M\+A\+X\+\_\+\+P\+A\+TH\mbox{]}
\item 
\mbox{\Hypertarget{_self_extract_8c_a767ef16ba55d1adc57b6432cc185b3c3}\label{_self_extract_8c_a767ef16ba55d1adc57b6432cc185b3c3}} 
\hyperlink{struct_d_e_c_o_m_p_r_e_s_s_e_d___f_i_l_e}{D\+E\+C\+O\+M\+P\+R\+E\+S\+S\+E\+D\+\_\+\+F\+I\+LE} {\bfseries Decompressed\+\_\+\+Files} \mbox{[}N\+B\+R\+\_\+\+C\+O\+M\+P\+R\+E\+S\+S\+E\+D\+\_\+\+F\+I\+L\+ES\mbox{]}
\item 
\mbox{\Hypertarget{_self_extract_8c_ad5b57bfb6757ad0eab8791d41449b55e}\label{_self_extract_8c_ad5b57bfb6757ad0eab8791d41449b55e}} 
volatile char $\ast$ {\bfseries Pipe\+Write\+Buf} = N\+U\+LL
\item 
\mbox{\Hypertarget{_self_extract_8c_a47df4ed4fbdd4853a1c3f0a1b756e146}\label{_self_extract_8c_a47df4ed4fbdd4853a1c3f0a1b756e146}} 
volatile H\+A\+N\+D\+LE {\bfseries h\+Child\+Stdin\+Write} = I\+N\+V\+A\+L\+I\+D\+\_\+\+H\+A\+N\+D\+L\+E\+\_\+\+V\+A\+L\+UE
\item 
\mbox{\Hypertarget{_self_extract_8c_a5d7c12a4f0b05fd4b45e86d88dd7d439}\label{_self_extract_8c_a5d7c12a4f0b05fd4b45e86d88dd7d439}} 
unsigned char $\ast$ {\bfseries Decompressed\+Data} = N\+U\+LL
\end{DoxyCompactItemize}


\subsection{Detailed Description}
The extractor for the executable files. 

\begin{DoxyVersion}{Version}
1.\+3.\+1 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
14/13/2016 
\end{DoxyDate}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{_self_extract_8c_af49c88ddbb3a4994e5b9eeb5fcdfebf5}\label{_self_extract_8c_af49c88ddbb3a4994e5b9eeb5fcdfebf5}} 
\index{Self\+Extract.\+c@{Self\+Extract.\+c}!Output\+Package\+File@{Output\+Package\+File}}
\index{Output\+Package\+File@{Output\+Package\+File}!Self\+Extract.\+c@{Self\+Extract.\+c}}
\subsubsection{\texorpdfstring{Output\+Package\+File}{OutputPackageFile}}
{\footnotesize\ttfamily \#define Output\+Package\+File~\char`\"{}Gost\+Crypt Setup \char`\"{} V\+E\+R\+S\+I\+O\+N\+\_\+\+S\+T\+R\+I\+NG \char`\"{}.exe\char`\"{}}

Copyright (c) 2008-\/2009 True\+Crypt Developers Association. All rights reserved.

Governed by the True\+Crypt License 3.\+0 the full text of which is contained in the file License.\+txt included in True\+Crypt binary and source code distribution packages. 

\subsection{Function Documentation}
\mbox{\Hypertarget{_self_extract_8c_ac03cfb6cd4ef918739df00c094019313}\label{_self_extract_8c_ac03cfb6cd4ef918739df00c094019313}} 
\index{Self\+Extract.\+c@{Self\+Extract.\+c}!Extract\+All\+Files\+Thread@{Extract\+All\+Files\+Thread}}
\index{Extract\+All\+Files\+Thread@{Extract\+All\+Files\+Thread}!Self\+Extract.\+c@{Self\+Extract.\+c}}
\subsubsection{\texorpdfstring{Extract\+All\+Files\+Thread()}{ExtractAllFilesThread()}}
{\footnotesize\ttfamily void \+\_\+\+\_\+cdecl Extract\+All\+Files\+Thread (\begin{DoxyParamCaption}\item[{void $\ast$}]{hwnd\+Dlg }\end{DoxyParamCaption})}



This function (that seems called as a thread) to extract the executable files, send a message if successed or failed. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em void} & $\ast$ hwnd\+Dlg \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void \+\_\+\+\_\+cdecl 
\end{DoxyReturn}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{_self_extract_8c_ac03cfb6cd4ef918739df00c094019313_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{_self_extract_8c_a2e765d66b3347c746e801dfa3b3fa0bc}\label{_self_extract_8c_a2e765d66b3347c746e801dfa3b3fa0bc}} 
\index{Self\+Extract.\+c@{Self\+Extract.\+c}!Is\+Self\+Extracting\+Package@{Is\+Self\+Extracting\+Package}}
\index{Is\+Self\+Extracting\+Package@{Is\+Self\+Extracting\+Package}!Self\+Extract.\+c@{Self\+Extract.\+c}}
\subsubsection{\texorpdfstring{Is\+Self\+Extracting\+Package()}{IsSelfExtractingPackage()}}
{\footnotesize\ttfamily B\+O\+OL Is\+Self\+Extracting\+Package (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Determines whether we are a self-\/extracting package. 

\begin{DoxyReturn}{Returns}
B\+O\+OL (Find\+String\+In\+File (path, Mag\+End\+Marker, strlen (Mag\+End\+Marker)) != -\/1) 
\end{DoxyReturn}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=323pt]{_self_extract_8c_a2e765d66b3347c746e801dfa3b3fa0bc_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{_self_extract_8c_aaf592c04ff2d8c23f59dba3079741b91}\label{_self_extract_8c_aaf592c04ff2d8c23f59dba3079741b91}} 
\index{Self\+Extract.\+c@{Self\+Extract.\+c}!Make\+Self\+Extracting\+Package@{Make\+Self\+Extracting\+Package}}
\index{Make\+Self\+Extracting\+Package@{Make\+Self\+Extracting\+Package}!Self\+Extract.\+c@{Self\+Extract.\+c}}
\subsubsection{\texorpdfstring{Make\+Self\+Extracting\+Package()}{MakeSelfExtractingPackage()}}
{\footnotesize\ttfamily B\+O\+OL Make\+Self\+Extracting\+Package (\begin{DoxyParamCaption}\item[{H\+W\+ND}]{hwnd\+Dlg,  }\item[{char $\ast$}]{sz\+Dest\+Dir }\end{DoxyParamCaption})}



Make a compressed extracted package to launch the program, in the folder sz\+Dest\+Dir and named thanks to Get\+Module\+File\+Name sz\+Dest\+Dir is the directories that contains setup files then load them. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em char} & $\ast$ sz\+Dest\+Dir \\
\hline
\mbox{\tt in}  & {\em H\+W\+ND} & hwnd\+Dlg \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
B\+O\+OL T\+R\+UE if the package has been extracted successfully F\+A\+L\+SE if there is an error 
\end{DoxyReturn}
\mbox{\Hypertarget{_self_extract_8c_a971f4b820217d5ad5e2039a4195bfd21}\label{_self_extract_8c_a971f4b820217d5ad5e2039a4195bfd21}} 
\index{Self\+Extract.\+c@{Self\+Extract.\+c}!Self\+Extract\+In\+Memory@{Self\+Extract\+In\+Memory}}
\index{Self\+Extract\+In\+Memory@{Self\+Extract\+In\+Memory}!Self\+Extract.\+c@{Self\+Extract.\+c}}
\subsubsection{\texorpdfstring{Self\+Extract\+In\+Memory()}{SelfExtractInMemory()}}
{\footnotesize\ttfamily B\+O\+OL Self\+Extract\+In\+Memory (\begin{DoxyParamCaption}\item[{char $\ast$}]{path }\end{DoxyParamCaption})}



Assumes that \hyperlink{_self_extract_8c_a64d92ae937dd021686b6fbed6dc6a572}{Verify\+Package\+Integrity()} has been used. Returns T\+R\+UE, if successful (otherwise F\+A\+L\+SE). Creates a table of pointers to buffers containing the following objects for each file\+: filename size, filename (not null-\/terminated!), file size, file C\+R\+C-\/32, uncompressed file contents. For details, see the definition of the \hyperlink{struct_d_e_c_o_m_p_r_e_s_s_e_d___f_i_l_e}{D\+E\+C\+O\+M\+P\+R\+E\+S\+S\+E\+D\+\_\+\+F\+I\+LE} structure. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em char} & $\ast$ path \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
B\+O\+OL F\+A\+L\+SE if (file\+Data\+End\+Pos $<$ 0) F\+A\+L\+SE if (file\+Data\+Start\+Pos $<$ 0) F\+A\+L\+SE if (!\+Load\+Int32 (path, \&uncompressed\+Len, file\+Pos)) F\+A\+L\+SE if (!\+Load\+Int32 (path, \&compressed\+Len, file\+Pos)) F\+A\+L\+SE if (compressed\+Len != file\+Data\+End\+Pos -\/ file\+Data\+Start\+Pos -\/ 8 + 1) F\+A\+L\+SE if (Decompressed\+Data == N\+U\+LL) F\+A\+L\+SE if (compressed\+Data == N\+U\+LL F\+A\+L\+SE if (Decompress\+Buffer (Decompressed\+Data, compressed\+Data, compressed\+Len) != uncompressed\+Len) F\+A\+L\+SE if (Decompressed\+\_\+\+Files\mbox{[}file\+No\mbox{]}.crc != Get\+Crc32 (Decompressed\+\_\+\+Files\mbox{[}file\+No\mbox{]}.file\+Content, Decompressed\+\_\+\+Files\mbox{[}file\+No\mbox{]}.file\+Length)) F\+A\+L\+SE if (file\+No $<$ N\+B\+R\+\_\+\+C\+O\+M\+P\+R\+E\+S\+S\+E\+D\+\_\+\+F\+I\+L\+ES) T\+R\+UE else 
\end{DoxyReturn}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=333pt]{_self_extract_8c_a971f4b820217d5ad5e2039a4195bfd21_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{_self_extract_8c_a15db30754007bf6fe4db42c07794e12c}\label{_self_extract_8c_a15db30754007bf6fe4db42c07794e12c}} 
\index{Self\+Extract.\+c@{Self\+Extract.\+c}!Self\+Extract\+Startup\+Init@{Self\+Extract\+Startup\+Init}}
\index{Self\+Extract\+Startup\+Init@{Self\+Extract\+Startup\+Init}!Self\+Extract.\+c@{Self\+Extract.\+c}}
\subsubsection{\texorpdfstring{Self\+Extract\+Startup\+Init()}{SelfExtractStartupInit()}}
{\footnotesize\ttfamily void Self\+Extract\+Startup\+Init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Call a deobfuscation function. 

\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}
\mbox{\Hypertarget{_self_extract_8c_a64d92ae937dd021686b6fbed6dc6a572}\label{_self_extract_8c_a64d92ae937dd021686b6fbed6dc6a572}} 
\index{Self\+Extract.\+c@{Self\+Extract.\+c}!Verify\+Package\+Integrity@{Verify\+Package\+Integrity}}
\index{Verify\+Package\+Integrity@{Verify\+Package\+Integrity}!Self\+Extract.\+c@{Self\+Extract.\+c}}
\subsubsection{\texorpdfstring{Verify\+Package\+Integrity()}{VerifyPackageIntegrity()}}
{\footnotesize\ttfamily B\+O\+OL Verify\+Package\+Integrity (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Verifies the C\+R\+C-\/32 of the whole self-\/extracting package (except the digital signature areas, if present) 

\begin{DoxyReturn}{Returns}
B\+O\+OL F\+A\+L\+SE if (file\+Data\+End\+Pos $<$ 0) F\+A\+L\+SE if (file\+Data\+Start\+Pos $<$ 0) F\+A\+L\+SE if (!\+Load\+Int32 (path, \&crc, file\+Data\+End\+Pos + strlen (Mag\+End\+Marker) + 1)) F\+A\+L\+SE if (tmp\+Buffer == N\+U\+LL) F\+A\+L\+SE if (crc != Get\+Crc32 (tmp\+Buffer, file\+Data\+End\+Pos + 1 + strlen (Mag\+End\+Marker))) T\+R\+UE else 
\end{DoxyReturn}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=314pt]{_self_extract_8c_a64d92ae937dd021686b6fbed6dc6a572_cgraph}
\end{center}
\end{figure}
