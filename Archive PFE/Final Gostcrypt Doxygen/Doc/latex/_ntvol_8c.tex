\hypertarget{_ntvol_8c}{}\section{Driver/\+Ntvol.c File Reference}
\label{_ntvol_8c}\index{Driver/\+Ntvol.\+c@{Driver/\+Ntvol.\+c}}


contains functions that open a volume / close a volume, and update the accessed time.  


{\ttfamily \#include \char`\"{}Gstdefs.\+h\char`\"{}}\newline
{\ttfamily \#include $<$wchar.\+h$>$}\newline
{\ttfamily \#include \char`\"{}Crypto.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Volumes.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Apidrvr.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Drive\+Filter.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Ntdriver.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Ntvol.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Volume\+Filter.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Boot/\+Windows/\+Boot\+Common.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Cache.\+h\char`\"{}}\newline
Include dependency graph for Ntvol.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{_ntvol_8c__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
N\+T\+S\+T\+A\+T\+US \hyperlink{_ntvol_8c_a5417ad2f111b636fbd8093be9f4f7fca}{G\+S\+T\+Open\+Volume} (P\+D\+E\+V\+I\+C\+E\+\_\+\+O\+B\+J\+E\+CT Device\+Object, \hyperlink{struct_e_x_t_e_n_s_i_o_n}{P\+E\+X\+T\+E\+N\+S\+I\+ON} Extension, M\+O\+U\+N\+T\+\_\+\+S\+T\+R\+U\+CT $\ast$mount, P\+W\+S\+TR pwsz\+Mount\+Volume, B\+O\+OL b\+Raw\+Device)
\begin{DoxyCompactList}\small\item\em Query the size of the device to open. Open the device and return error messages. Then check the file format we want to open (N\+T\+FS / F\+AT ...) then check volume size and type (hidden ...) and read the header. Attempt to decrypt the header. Decrypt the sectors. Protect the hidden volume (don\textquotesingle{}t decrypt them). \end{DoxyCompactList}\item 
void \hyperlink{_ntvol_8c_a3e05d294f15f24148106049b4cab1237}{G\+S\+T\+Close\+Volume} (P\+D\+E\+V\+I\+C\+E\+\_\+\+O\+B\+J\+E\+CT Device\+Object, \hyperlink{struct_e_x_t_e_n_s_i_o_n}{P\+E\+X\+T\+E\+N\+S\+I\+ON} Extension)
\begin{DoxyCompactList}\small\item\em Close the volume decrypted thanks to the previous function. \end{DoxyCompactList}\item 
N\+T\+S\+T\+A\+T\+US \hyperlink{_ntvol_8c_a48aec4d8c18a1774e6662108d9a0cfb5}{G\+S\+T\+Send\+Host\+Device\+Io\+Control\+Request} (P\+D\+E\+V\+I\+C\+E\+\_\+\+O\+B\+J\+E\+CT Device\+Object, \hyperlink{struct_e_x_t_e_n_s_i_o_n}{P\+E\+X\+T\+E\+N\+S\+I\+ON} Extension, U\+L\+O\+NG Io\+Control\+Code, void $\ast$Output\+Buffer, U\+L\+O\+NG Output\+Buffer\+Size)
\begin{DoxyCompactList}\small\item\em Call the driver with an irp to return the block status. \end{DoxyCompactList}\item 
N\+T\+S\+T\+A\+T\+US \hyperlink{_ntvol_8c_a65a14c883adcc3846c8b707bebf3537b}{C\+O\+M\+P\+L\+E\+T\+E\+\_\+\+I\+RP} (P\+D\+E\+V\+I\+C\+E\+\_\+\+O\+B\+J\+E\+CT Device\+Object, P\+I\+RP Irp, N\+T\+S\+T\+A\+T\+US Irp\+Status, U\+L\+O\+N\+G\+\_\+\+P\+TR Irp\+Information)
\begin{DoxyCompactList}\small\item\em Complete the I\+RP with data (extra info provide the adresses completed) \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
volatile B\+O\+OL \hyperlink{_ntvol_8c_ad638c62db1e7059c1cdbbc4173dcac67}{Probing\+Host\+Device\+For\+Write} = F\+A\+L\+SE
\end{DoxyCompactItemize}


\subsection{Detailed Description}
contains functions that open a volume / close a volume, and update the accessed time. 

\begin{DoxyVersion}{Version}
1.\+3.\+1 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
13/12/2016 
\end{DoxyDate}


\subsection{Function Documentation}
\mbox{\Hypertarget{_ntvol_8c_a65a14c883adcc3846c8b707bebf3537b}\label{_ntvol_8c_a65a14c883adcc3846c8b707bebf3537b}} 
\index{Ntvol.\+c@{Ntvol.\+c}!C\+O\+M\+P\+L\+E\+T\+E\+\_\+\+I\+RP@{C\+O\+M\+P\+L\+E\+T\+E\+\_\+\+I\+RP}}
\index{C\+O\+M\+P\+L\+E\+T\+E\+\_\+\+I\+RP@{C\+O\+M\+P\+L\+E\+T\+E\+\_\+\+I\+RP}!Ntvol.\+c@{Ntvol.\+c}}
\subsubsection{\texorpdfstring{C\+O\+M\+P\+L\+E\+T\+E\+\_\+\+I\+R\+P()}{COMPLETE\_IRP()}}
{\footnotesize\ttfamily void C\+O\+M\+P\+L\+E\+T\+E\+\_\+\+I\+RP (\begin{DoxyParamCaption}\item[{P\+D\+E\+V\+I\+C\+E\+\_\+\+O\+B\+J\+E\+CT}]{Device\+Object,  }\item[{P\+I\+RP}]{Irp,  }\item[{N\+T\+S\+T\+A\+T\+US}]{Irp\+Status,  }\item[{U\+L\+O\+N\+G\+\_\+\+P\+TR}]{Irp\+Information }\end{DoxyParamCaption})}



Complete the I\+RP with data (extra info provide the adresses completed) 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em P\+D\+E\+V\+I\+C\+E\+\_\+\+O\+B\+J\+E\+CT} & Device\+Object \\
\hline
\mbox{\tt in}  & {\em P\+I\+RP} & Irp \\
\hline
\mbox{\tt in}  & {\em N\+T\+S\+T\+A\+T\+US} & Irp\+Status \\
\hline
\mbox{\tt in}  & {\em U\+L\+O\+N\+G\+\_\+\+P\+TR} & Irp\+Information \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
N\+T\+S\+T\+A\+T\+US Irp\+Status 
\end{DoxyReturn}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=326pt]{_ntvol_8c_a65a14c883adcc3846c8b707bebf3537b_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{_ntvol_8c_a3e05d294f15f24148106049b4cab1237}\label{_ntvol_8c_a3e05d294f15f24148106049b4cab1237}} 
\index{Ntvol.\+c@{Ntvol.\+c}!G\+S\+T\+Close\+Volume@{G\+S\+T\+Close\+Volume}}
\index{G\+S\+T\+Close\+Volume@{G\+S\+T\+Close\+Volume}!Ntvol.\+c@{Ntvol.\+c}}
\subsubsection{\texorpdfstring{G\+S\+T\+Close\+Volume()}{GSTCloseVolume()}}
{\footnotesize\ttfamily void G\+S\+T\+Close\+Volume (\begin{DoxyParamCaption}\item[{P\+D\+E\+V\+I\+C\+E\+\_\+\+O\+B\+J\+E\+CT}]{Device\+Object,  }\item[{\hyperlink{struct_e_x_t_e_n_s_i_o_n}{P\+E\+X\+T\+E\+N\+S\+I\+ON}}]{Extension }\end{DoxyParamCaption})}



Close the volume decrypted thanks to the previous function. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em P\+E\+X\+T\+E\+N\+S\+I\+ON} & Extension \\
\hline
\mbox{\tt in}  & {\em P\+D\+E\+V\+I\+C\+E\+\_\+\+O\+B\+J\+E\+CT} & Device\+Object \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}
\mbox{\Hypertarget{_ntvol_8c_a5417ad2f111b636fbd8093be9f4f7fca}\label{_ntvol_8c_a5417ad2f111b636fbd8093be9f4f7fca}} 
\index{Ntvol.\+c@{Ntvol.\+c}!G\+S\+T\+Open\+Volume@{G\+S\+T\+Open\+Volume}}
\index{G\+S\+T\+Open\+Volume@{G\+S\+T\+Open\+Volume}!Ntvol.\+c@{Ntvol.\+c}}
\subsubsection{\texorpdfstring{G\+S\+T\+Open\+Volume()}{GSTOpenVolume()}}
{\footnotesize\ttfamily G\+S\+T\+Open\+Volume (\begin{DoxyParamCaption}\item[{P\+D\+E\+V\+I\+C\+E\+\_\+\+O\+B\+J\+E\+CT}]{Device\+Object,  }\item[{\hyperlink{struct_e_x_t_e_n_s_i_o_n}{P\+E\+X\+T\+E\+N\+S\+I\+ON}}]{Extension,  }\item[{M\+O\+U\+N\+T\+\_\+\+S\+T\+R\+U\+CT $\ast$}]{mount,  }\item[{P\+W\+S\+TR}]{pwsz\+Mount\+Volume,  }\item[{B\+O\+OL}]{b\+Raw\+Device }\end{DoxyParamCaption})}



Query the size of the device to open. Open the device and return error messages. Then check the file format we want to open (N\+T\+FS / F\+AT ...) then check volume size and type (hidden ...) and read the header. Attempt to decrypt the header. Decrypt the sectors. Protect the hidden volume (don\textquotesingle{}t decrypt them). 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em B\+O\+OL} & b\+Raw\+Device \\
\hline
\mbox{\tt in}  & {\em P\+W\+S\+TR} & pwsz\+Mount\+Volume \\
\hline
\mbox{\tt in}  & {\em M\+O\+U\+N\+T\+\_\+\+S\+T\+R\+U\+CT} & $\ast$ mount \\
\hline
\mbox{\tt in}  & {\em P\+E\+X\+T\+E\+N\+S\+I\+ON} & Extension \\
\hline
\mbox{\tt in}  & {\em P\+D\+E\+V\+I\+C\+E\+\_\+\+O\+B\+J\+E\+CT} & Device\+Object \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
N\+T\+S\+T\+A\+T\+US S\+T\+A\+T\+U\+S\+\_\+\+S\+U\+C\+C\+E\+SS status else 
\end{DoxyReturn}
\mbox{\Hypertarget{_ntvol_8c_a48aec4d8c18a1774e6662108d9a0cfb5}\label{_ntvol_8c_a48aec4d8c18a1774e6662108d9a0cfb5}} 
\index{Ntvol.\+c@{Ntvol.\+c}!G\+S\+T\+Send\+Host\+Device\+Io\+Control\+Request@{G\+S\+T\+Send\+Host\+Device\+Io\+Control\+Request}}
\index{G\+S\+T\+Send\+Host\+Device\+Io\+Control\+Request@{G\+S\+T\+Send\+Host\+Device\+Io\+Control\+Request}!Ntvol.\+c@{Ntvol.\+c}}
\subsubsection{\texorpdfstring{G\+S\+T\+Send\+Host\+Device\+Io\+Control\+Request()}{GSTSendHostDeviceIoControlRequest()}}
{\footnotesize\ttfamily void G\+S\+T\+Send\+Host\+Device\+Io\+Control\+Request (\begin{DoxyParamCaption}\item[{P\+D\+E\+V\+I\+C\+E\+\_\+\+O\+B\+J\+E\+CT}]{Device\+Object,  }\item[{\hyperlink{struct_e_x_t_e_n_s_i_o_n}{P\+E\+X\+T\+E\+N\+S\+I\+ON}}]{Extension,  }\item[{U\+L\+O\+NG}]{Io\+Control\+Code,  }\item[{void $\ast$}]{Output\+Buffer,  }\item[{U\+L\+O\+NG}]{Output\+Buffer\+Size }\end{DoxyParamCaption})}



Call the driver with an irp to return the block status. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em P\+D\+E\+V\+I\+C\+E\+\_\+\+O\+B\+J\+E\+CT} & Device\+Object \\
\hline
\mbox{\tt in}  & {\em P\+E\+X\+T\+E\+N\+S\+I\+ON} & Extension \\
\hline
\mbox{\tt in}  & {\em U\+L\+O\+NG} & Io\+Control\+Code \\
\hline
\mbox{\tt in}  & {\em void} & $\ast$ Output\+Buffer \\
\hline
\mbox{\tt in}  & {\em U\+L\+O\+NG} & Output\+Buffer\+Size \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
N\+T\+S\+T\+A\+T\+US nt\+Status 
\end{DoxyReturn}


\subsection{Variable Documentation}
\mbox{\Hypertarget{_ntvol_8c_ad638c62db1e7059c1cdbbc4173dcac67}\label{_ntvol_8c_ad638c62db1e7059c1cdbbc4173dcac67}} 
\index{Ntvol.\+c@{Ntvol.\+c}!Probing\+Host\+Device\+For\+Write@{Probing\+Host\+Device\+For\+Write}}
\index{Probing\+Host\+Device\+For\+Write@{Probing\+Host\+Device\+For\+Write}!Ntvol.\+c@{Ntvol.\+c}}
\subsubsection{\texorpdfstring{Probing\+Host\+Device\+For\+Write}{ProbingHostDeviceForWrite}}
{\footnotesize\ttfamily volatile B\+O\+OL Probing\+Host\+Device\+For\+Write = F\+A\+L\+SE}

Legal Notice\+: Some portions of the source code contained in this file were derived from the source code of Encryption for the Masses 2.\+02a, which is Copyright (c) 1998-\/2000 Paul Le Roux and which is governed by the \textquotesingle{}License Agreement for Encryption for the Masses\textquotesingle{}. Modifications and additions to the original source code (contained in this file) and all other portions of this file are Copyright (c) 2003-\/2010 True\+Crypt Developers Association and are governed by the True\+Crypt License 3.\+0 the full text of which is contained in the file License.\+txt included in True\+Crypt binary and source code distribution packages. 